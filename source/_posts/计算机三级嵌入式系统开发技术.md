---
title: 计算机三级嵌入式系统开发技术（持续更新中……）
author: ZERO JAN
avatar: 'https://cdn.jsdelivr.net/gh/FengYJ120/CDN/MyBlog/img/custom/avatar.jpg'
authorLink: 'https://www.zero-jan.xyz'
categories: 技术
tags: 学习笔记
description: 计算机三级嵌入式学习笔记
comments: ture
abbrlink: e738
photos: 'https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/计算机三级.jpeg'
date: 2021-01-30 22:36:34
---

## 第一章-嵌入式系统概论

### 考纲与考点分析

#### 嵌入式系统开发的基础知识
1. 嵌入式系统的特点、分类、发展与应用；
2. 嵌入式系统的组成与微电子技术 （集成电路、SoC、IP核等技术的作用和发展）；
3. 数字媒体基础（文本、图像和音频/视频等数字媒体的表示与处理）；
4. 网络通信技术（数字通信与计算机网络，TCP/IP协议，互联网接入技术等）。

#### 考点分析
- 在考试中一般情况下会出现在*选择题1~3（知识类型为理论型，需多记多背）*
- 常考知识点有：
  - 了解嵌入式系统的特点、分类、发展与应用，熟悉嵌入式系统的逻辑组成。
  - 了解嵌入式处理芯片的主要类型，熟悉SoC的开发流程，理解IP核的重要意义。
  - 熟悉中西文字的编码和数字文本的类型与处理，掌握数字图像的参数、文件格式及其主要应用。
  - 理解计算机网络的分类与组成，熟悉IP协议的主要内容，掌握互联网的组成和常用接入技术。

### 考点1 嵌入式系统及其应用

#### 什么是嵌入式系统？
- 嵌入式系统是嵌入式计算机系统的简称。顾名思义，它是一种嵌入在设备（或系统）内部，为**特定应用**而设计的专用计算机系统

#### 嵌入式系统的共同特点
1. **专用性**
   与具体应用紧密结合，具有很强的专用性
2. **隐蔽性**
   通常隐藏在内部，不为人知；例如：ATM柜员机、数码相机
3. **资源受限**
   软硬件资源受到严格限制
4. **高可靠性**
   对于汽车等中的嵌入式，任何误动作都是致命的
5. **实时性** 
   温控需要实时数据
6. **软件固化**
   ROM固化
   
#### 嵌入式系统的应用
1. 消费类应用产品
   1. **“白色家电”**
      冰箱、洗衣机、空调、微波炉、电饭煲、热水器等
   2. **数码产品**
      电视机、家庭影院、PDA、电子字典、游戏机、智能玩具等
2. 产业类应用产品
   1. **工业设备**
      数控机床、工业机器人、机电一体化设备、生产线控制等
   2. **运输工具**
      汽车、飞机、铁路机车、船舶、电梯等
   3. **医疗电子设备**
      X光机、B超（超声诊断仪）、CT（计算机断层成像系统）、心脏起搏器、监护仪
3. 业务类应用产品
   1. **办公设备**
      电话机、传真机、打印机、复印机等
   2. **金融电子设备**
      电子秤、POS（商用零售终端）、ATM（自动柜员机）、信息亭等
   3. **通信设备**
      手机、GPS导航仪、Moderm、路由器、Hub（集线器）、交换机、网桥等
4. 军用类应用产品
   1. **武器控制装置**    
      火炮、导弹、智能炸弹的制导引爆等     
   2. **军用电子装备**
      坦克、舰艇、战机、无人机等
   3. **军事通信装备**
      雷达、电子对抗、导航系统等

#### 嵌入式系统的发展意义
1. 嵌入式系统在应用数量上远远超过了各种类型的通用计算机系统。
2. 嵌入式系统正在逐步渗透到人类社会的各个领域，嵌入式应用构成了所谓“ **无所不在的计算时代** ”。
3. 嵌入式系统的研发能力及产业化水平已经成为衡量一个国家**经济发展**、**科技进步**和**国防实力**的重要标志 。

### 考点2 嵌入式系统的组成

#### 嵌入式系统的逻辑组成
1. 嵌入式系统与通用计算机一样，也是由**硬件**和**软件**两部分组成的。
2. 硬件的主体是**中央处理器**和**存储器**，它们通过**输入/输出(I/O)接口**和**输入/输出设备**与外部世界联系 ，并借助总线相互连接，这些硬件连同嵌入式软件一起构成完整的嵌入式系统。

#### 处理器的组成
1. 能按照指令的规定高速度完成二进制数据算术和逻辑运算的部件称为“处理器”
2. 它由**运算器**、**控制器**、**寄存器**、**高速缓冲存储器（Cache）**等部件组成，结构相当复杂。
3. 处理器的所有组成部分都可以制作在一块大小仅为几cm<sup>2</sup>的半导体芯片上。

#### 嵌入式系统中的处理器分类
1. **中央处理器（CPU）**
   负责运行系统软件和应用软件的主处理器
2. **协处理器**
   DSP（数字信号处理器）、图形处理器、通信处理器

#### 中央处理器（CPU）的参数
1. **字长**
   指的是CPU中通用寄存器和定点运算器的二进位宽度
2. **CPU字长**
   4位、8位、16位、32位和64位（通用计算机64位为主）
   - 说明：虽然32位和64位是当前技术发展的主流，但销量仅占全部微处理器的**10%左右**
3. **CPU性能**
   **表现为程序**（指令）执行速度的快慢

#### 中央处理器（CPU）特点
1. **支持实时处理**
2. **低功耗**
3. **结构可扩展**
4. **集成测试电路**

#### 影响程序（指令）执行速度的因素
- **主频**、**指令系统**、**Cache的容量与结构和逻辑结构**。

#### 存储器的分类
1. **易失性存储器**
   即掉电后信息丢失
   SARM（静态随机存取存储器）、DRAM（动态随机存取存储器）
2. **非易失性存储器**
   E<sup>2</sup>PROM（电可擦可编程只读存储器）、Falsh ROM、磁盘和光盘存储器
   - 说明：非易失性存储器有多种类型。以前使用较多的是Mask ROM和E<sup>2</sup>PROM，**目前使用较多是闪存**，即Falsh Memory。 
   - Mask ROM是基于掩膜工艺技术的只读存储器，一旦生产出来信息不可改变，主要用于**不可升级的成熟产品存储程序**或**不变的参数等信息**；
   - Falsh Memory是一种长寿命的非易失性存储器，是近些年应用最广的只读存储器。

#### I/O设备按其服务对象分类
1. 用于**人机交互**的设备
   键盘、鼠标、话筒、LED、LCD、打印机等，他们是用户界面的硬件部分。
2. 用于**机机交互**的设备
   包括各种类型的传感器（压力传感器、电流电压传感器等）
   和各种伺服执行机构（继电器、微电机、步进电机等）

#### I/O接口的分类
1. 按数据传输速率
   **低速**和**高速**
2. 按数据传输方式
   **串行**和**并行**
3. 按是否需要物理连接
   **有线**和**无线**
4. 按是否能连接多个设备
   **总线式**和**独占式**

#### 嵌入式系统常用的I/O接口
1. **通用串行总线式接口**
   USB2.0/USB3.0、IEEE 1394、以太网接口
2. **异步串行接口**
   RS-232-C、RS-485
3. **视频信号接口**
   VGA接口（视频图形排列接口）、DVI接口（数字视频接口）、HDMI接口（高清晰度多媒体接口）
4. **工业总线接口**
   CAN接口（控制器局域网接口）、1553B接口、LIN接口（局域互联网接口）
5. **无线接口**
   IrDR接口（红外线接口）、Bluetooth接口（蓝牙接口）、ZigBee接口、WiFi接口

#### 数据总线的概念
- 数据总线简称**总线**，它是嵌入式系统各组件之间**进行数据传输**的一个传输通路。它由传输线和控制电路组成，为连接在总线上的系统内或系统外的各个组件提供数据传输和相应的控制服务。 

#### 嵌入式系统的软件配置
1. 低端嵌入式系统
   软件很**简单**，它们不需要操作系统，只需配置一个监控程序、若干设备驱动程序和事件处理程序即可。
2. 高端嵌入式系统
   软件配置**比较复杂**。它通常由**板级支持包**（BSP）、**设备驱动程序**、**实时操作系统**、**中间件**以及**嵌入式应用软件**等组成。

#### 嵌入式处理芯片4种产品类型
1. **微处理器**
   根据CPU的字长，微处理器产品分为4位、8位、16位、32位和64位 ，产品主要有PowerPC、MC68000、MIPS、AMD、x86。
2. **数字信号处理器**
   DSP是一种专用于数字信号处理的微处理器，它对通用处理器的逻辑结构和指令系统进行了优化设计，使之能更好地**满足高速数字信号处理的要求**。
   ![image-20210131222114547](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210131222114547.png)
3. **微控制器（单片机）**
   微控制器实际上是一种将若干个功能模块集成在单个芯片中的小型计算机。
   它们的工作频率不高，存储容量较小，功耗很低；
   MCU按其使用的处理器内核的位数，也经历了**1位、4位、8位、16位以及32位**的发展阶段。
   早先的4位主要用于**家用电器的控制单元**，8位和16位用于**一般的控制领域**，近年来32位MCU迅速发展。
   MCU品种多，应用广泛，约占有嵌入式系统**70**%的市场。
4. **片上系统（SoC）**
   半导体加工工艺已经进入到深亚微米时代，能够把计算机或其他一些电子系统的全部电路都集成在单个芯片上，这种芯片就是所谓的片上系统。
   因此片上系统是集成电路加工工艺进入到**深亚微米时代的产物** 。
   目前，大多数高端嵌入式系统均采用 SoC（片上系统），例如：智能手机。
   - 说明：将嵌入式系统的几乎全部功能都集成在一块芯片中，单个芯片就能实现数据的采集、转换、存储、处理和输入/输出等多种功能。 

### 考点3 嵌入式系统的分类

#### 嵌入式系统的分类
1. 按用途分类
   **军用**、**工业用**和**民用**
2. 按实时性的分类
   **非实时系统**、**软实时系统**和**硬实时系统**
3. 按产品形态分类
   **系统级产品**、**板级产品**和**片级产品**
4. 按软硬件复杂程度分类
   **低端系统**、**中端系统**和**高端系统**

#### 不同类型嵌入式系统的比较
|   类型   |               硬件特征                |                           软件特征                           |                     应用举例                     |
| :------: | :-----------------------------------: | :----------------------------------------------------------: | :----------------------------------------------: |
| 低端系统 |           采用4位/8位单片机           |           不使用操作系统，由监控程序对系统进行控制           |    在**工控领域**和**白色家电**领域占主导地位    |
| 中端系统 |    采用8位/16位单片机或32位处理器     |  使用小型嵌入式操作系统，应用程序规模较小，用户界面比较简单  |   普通手机、摄像机、录像机、电视游戏机等（2G）   |
| 高端系统 | 采用32位/64位处理器，支持**连接网络** | 操作系统功能比较齐全，使用图形用户界面，应用软件可更新和扩展 | 智能手机、掌上计算机、路由器、气象数据处理设备等 |

<!-- ![image-20210202190127443](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210202190127443.png) -->

### 考点4 SoC芯片

#### 1、微电子技术

##### 集成电路以及制造
1. 微电子技术是以半导体集成电路为核心。根据所含电子元件的数目可以分为小规模、中规模、大规模和极大规模等几种。
   - 大规模集成电路（LSI）
     集成度在3000~**10万**个电子元件之间的集成电路。
   - 超大规模集成电路（VLSI）
     集成度在10万~**100万**个电子元件之间的集成电路。
   - 极大规模集成电路（ULSI）
     集成度**超过100万**个电子元件的集成电路。
2. 集成电路的制造**工艺复杂**且**技术难度非常高**，其中有一系列的关键技术。许多工序必须在恒温、恒湿、超洁净的**无尘厂房**内完成，生产、控制及测试**设备异常昂贵**。
3. 集成电路是在**硅衬底**上制作而成的。
4. 制造集成电路所用的工艺技术称为硅平面工艺，包括**氧化**、**光刻**、**掺杂**等多项工艺。

##### 集成电路的发展趋势
1. 集成电路的特点是**体积小**、**重量轻**、**可靠性高**；
2. 集成电路的工作速度主要取决于组成逻辑门电路的晶体管的尺寸。晶体管的**尺寸越小**，其极限工作频率越高， 门电路的开关**速度就越快**。
3. 芯片上电路元件的**线条越细**，相同面积的晶片可容纳的晶体管就越多，**功能就越强**，速度也越快。
4. 当前，世界上最为先进的制作工艺已经达到**12~14英寸晶圆**、**45nm或32nm**的工艺水平，并还在进一步提高。
5. 最复杂的CPU芯片所集成的晶体管数目已超过**10亿**个，移动设备存储卡所用的每个芯片包含的晶体管数量已达**100亿**个。
6. 目前，芯片中晶体管数目已达数十亿个，**时钟频率**达到10GHz （*不是工作频率*）

##### 微机电系统
- MEMS体现了近年来机电一体化技术向微型化的发展；
- 目前的MEMS产品有压力传感器、加速仪、陀螺仪、麦克风、微射流器件等许多种，它对促进产品小型化、智能化、集成化有重大的作用；
- **在智能手机中应用广泛。**

#### 2、通用SoC和专用SoC

##### 通用SoC
- 指半导体企业通过**自主开发处理器内核**或购买其他企业的处理器内核的**IP授权**，按照目标应用领域功能要求所开发的SoC芯片系列；
- 如：三星Exynos系列、英达伟Tegra系列、**高通骁龙系列**、**联发科MT系列**，这些芯片大多采用ARM公司的**Cortex-A架构**作为CPU内核。
- 说明： 通用的芯片中可以只有一个CPU（或DSP ），称为单核SoC，也可以包含多个CPU（或DSP ），称为多核SoC。

##### 专用SoC
- 嵌入式系统开发商依据待开发产品的特殊要求，向半导体企业定制的SoC芯片；
- 如：**苹果公司的iPhone**、iPad和iPod等消费电子产品。

#### 3、SoC芯片的开发流程
![image-20210201170247184](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210201170247184.png)
1. **总体设计**
   按照系统需求说明书确定*SoC的性能参数*，并据此进行系统全局的设计。
2. **逻辑设计**
   将总体设计的结果用*RTL语言*进行描述（源文件）后，再使用逻辑综合软件将源文件进行综合，生成最简的布尔表达式和信号的连接关系。
3. **综合仿真**
   这一阶段将对由RTL生成的各部分电路图作芯片电路*综合及仿真测试*。
4. **芯片制造**
   将经过验证后的逻辑电路配置入SoC芯片内，并与其他电路进行互连。

#### 4、IP核及其复用

##### IP核
1. 以库中所包含的IC设计文件按其**功能复杂程度**分为三类：
   - **逻辑门级**，包括各种基本的门电路；
   - **寄存器传输级**，如寄存器、多路选择器、译码器、数据转换器等；
   - **行为级**（又称为**功能级**），如CPU、DSP、存储器、总线与接口电路等。
2. 这些已完成的并经过验证的IC具有固定的不可再分解的功能特性，人们称之为“核”（Core），相应的数据库称为“核库”。
   - 核库中的设计文件均属于知识产权（IP）保护的范畴。
   - IP核分类： 软核、固核和硬核。（类比：砖、房间、一层楼）
- 从可重用的频度、重用的灵活性以及可向其他工艺**移植**的可能性的角度考虑，这三种IP核的优选次序是软核、固核和硬核； 
- 从保证满足所要求的性能和规范、上市时间短、**开发工作量少**且不在乎成本的角度考虑，这三种IP核的优选次序是 硬核、固核和软核。

##### IP核复用
1. SoC芯片的产生是半导体集成电路技术发展到一定阶段的产物，是集成电路芯片的跨越式发展；
2. IP核是开发SoC的重要保证，IP核复用可以**减少研发成本**，**缩短研发时间**；
3. 以CPU为例。**所有SoC芯片都包含CPU**，它们绝大多数都是**以IP核的方式**集成在SoC芯片中的，很少再自行设计开发；
4. 目前主要的CPU内核有：**ARM**、**MIPS**、PowerPC、Coldfire、x86、8051等；
5. ARM内核的授权内容包括：**芯片内核设计技术**、**完整的软件开发工具**（编译器、调试器、 软件开发套件SDK）、 含ARM CPU的**芯片销售权**等。

### 考点5 数字（电子）文本

#### 1、字符集及其编码
- 文本是基于特定字符集的一个字符流，每个字符均使用**二进制编码**表示。

##### 西文字符的编码
- 目前计算机中使用得最广泛的西文字符集及其编码是**ASCII字符集和ASCII码**，即美国标准信息交换码。
- 基本的ASCII字符集共有**128**个字符，包括**96**个可打印字符（常用的拉丁字母、阿拉伯数字、标点符号等）和**32**个控制字符，每个字符使用**7个二进制位**进行编码。 

##### 汉字的编码
- 我国目前广泛使用的汉字编码国家标准有**GB2312**和**GB18030**；
- GB2312只有**6763**个汉字，而且为**简体字**，在人名、地名的处理上经常不够使用。尤其是在古籍整理和研究方面有很大缺憾。
- GB2312国标字符集中包含3775个一级常用汉字和3008个二级常用汉字，此外还有682个图形符号（包括*拉丁字母、俄文、日文平假名与片假名、希腊字母、汉语拼音*等）。
- 我国在2005年又发布了GB18030中文编码国家标准。

##### UCS/Unicode编码
- 用于计算机**统一**处理、存储和传输包含世界各国和地区所有各种语言文字的需求；编码方案最常用的有两种：**UTF-8和UTF-16**。
- UTF-8采用的是**单字节**可变长编码，一般使用**3字节**编码，极少数使用4字节。
- UTF-16采用的是**双字节**可变长编码，一般使用**双字节**编码，其他不常用字符使用4字节。
- 说明：GB18030字符集与国际标准UCS/Unicode字符集**基本兼容**，但其码制不一样；GB18030与UCS/Unicode**均包含中日韩统一汉字**（CJK）约7万多个。

#### 2、文本的类型

##### 根据是否具有排版格式分类
1. **简单文本**
   几乎不包含任何其他的格式信息和结构信息，也称为纯文本，文件扩展名是**\.txt**；
2. **丰富格式文本**
   需要对纯文本进行必要的加工，也称为富文本，文件扩展名包括：**\.doc、\.html和\.pdf**。

##### 根据文本内容的组织方式分类
1. **线性文本**
   文本中的内容组织是**线性**（顺序）的，如简单文本。
2. **超文本**
   采用**网状结构**来组织信息，文本中的各个部分按照其内容的逻辑关系相互链接，如**WWW网页**是最为常见的超文本。。

#### 3、文本的制作与展现

##### 文本制作
- 文字处理软件：WPS、Microsoft Word等等。数字文本阅读器可以是软件，也可以是一种称为“电子书阅读器”的嵌入式应用产品。
- 2009年**PDF格式**被批准为我国用于**长期保存的电子文档格式的国家标准**。
- PDF（便携式文件格式）是由Adobe Systems在1993年用于文件交换所发展出的文件格式。它的优点在于跨平台、能保留文件原有格式（Layout）、开放标准，能免版税（Royalty-free）自由开发PDF相容软体，是一个开放标准，2007年12月成为ISO 32000国际标准。

##### 文本展现（阅读）
- 数字电子文本主要有两种展现方式：**打印输出**和在**屏幕上进行阅读。**
- 字符的形状有两种描述方法：**点阵法**和**轮廓法**。

### 考点6 数字图像
- 嵌入式系统中使用的数字图像也称为**取样图像**、**点阵图像**或**位图图像**。

#### 1、数字图像的获取与主要参数

##### 数字图像的获取所使用的设备及其功能
- 设备：**数码相机**和**扫描仪**。
- 功能：将实际景物的**2D映像**输入到计算机内并以数字图像的形式进行表示。

##### 数字图像的获取处理步骤
​	图像的获取过程的核心是**模拟信号的数字化**，处理步骤大体分为4步：
1. **扫描**
   扫描将画面划分为M x N个网格，每个网格称为一个取样点。*离散化*
2. **分色**
   将每个取样点的颜色分解成红、绿、蓝（R、G、B）3个基色，如果是灰度图像或黑白图像，则不必进行分色。
3. **取样**
   测量每个取样点的每个分量（基色）的*亮度值。*
4. **量化**
   对取样点每个分量的亮度值进行A/D转换，即把模拟量使用数字量（一般是8位至12位的正整数）来表示。

##### 数字图像的主要参数及其含义
- 图像大小
  也称为**图像分辨率**（用水平分辨率 x 垂直分辨率表示）。日常所说的高清图像分辨率为1920 x 1080；
- 位平面数目
  即像素颜色分量的数目。**黑白或灰度**图像只有一个位平面，**彩色图像**有**3个或更多**的位平面；
- 像素深度
  指每像素用多少个二进制位来表示。它是像素的**所有颜色分量的二进制位数之和**，它决定了图像中可能出现的不同颜色（或不同亮度）的最大数目。
  例如单色图像，若其像素深度是8位，则不同亮度等级的总数为2<sup>8</sup>=256；
- 颜色模型
  指彩色图像所使用的颜色描述方法。通常， **显示器使用的是RGB**( 红、绿、 蓝）模型， **彩色打印机使用的是CMYK**(青、品红、黄、黑）模型。

#### 2、数字图像常用文件格式及其应用

##### 一副图像的数据量计算公式_(以字节为单位)_
- **图像数据量 = 图像水平分辨率 x 图像垂直分辨率 x 像素深度 / 8**

##### 数据压缩的类型
1. **无损压缩**
   指使用压缩以后的数据还原图像（也称为解压缩）时，重建的图像与原始图像完全相同，没有一点误差。例如：行程长度编码（RLE）、哈夫曼编码。*压缩率不高*
2. **有损压缩**
   指使用压缩后的图像数据进行还原时，重建的图像与原始图像虽有一些误差，但不影响人们对图像含义的正确理解和使用。为了得到较高的数据压缩比，数字图像的压缩**一般都采用有损压缩**，如变换编码、矢量编码等。

##### 嵌入式系统常用的几种图像文件的格式
| 名称 |       压缩编码办法        |    性质    |      典型应用      | 开发公司（组织） |
| :--: | :-----------------------: | :--------: | :----------------: | :--------------: |
| **BMP**  |            RLE            |    无损    |  Windows应用程序   |    Microsoft     |
| TIF  |         RLE，LZW          |    无损    |      桌面出版      | Aldus，Microsoft |
| GIF  |            LZW            |    无损    |       互联网       |    CompuServe    |
| **JPEG** |      DCT，哈夫曼编码      | 大多为有损 | 互联网、数码相机等 |     ISO/IEC      |
| PNG  | LZ77派生的DEFLATE压缩算法 |    无损    | 互联网、桌面出版等 |       W3C        |

<!-- ![image-20210202185556478](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210202185556478.png) -->
- PNG属于静态图像格式

### 考点7 数字音频与数字视频
- 音频指的是人耳可听见的声音信号，视频泛指*活动图像序列*，它们都是传递信息的重要媒体。共同的特点是内容随时间而变化，所以也称为*动态媒体*。

#### 1、音频/视频信息的数字化
- 音频是频率范围为**20Hz~20kHz**的模拟信号。为了使用计算机进行处理，必须将它转换成二进制编码表示的形式， 这个过程称为声音信号的数字化。

##### 声音信号数字化的过程
- **取样**
  把时间上连续的声音信号离散为不连续的一系列的样本；
- **量化**
  把每个样本的模拟量转换成数字量来表示，因此量化过程往往也称为**A/D转换**；
- **编码**
  经过取样和量化得到的数据必须进行**数据压缩**，以**减少数据量**，并**按某种格式**将数据组织为**文件**，以便于计算机进行存储、处理和传输。

##### 视频信号数字化的过程
- 视频信号数字化的过程比声音复杂一些，它以一幅幅画面（称为**帧** ）为单位进行。

#### 2、数字音频常用文件格式及其应用

##### 数字音频的主要参数
- 数字音频的主要参数包括**取样频率**、**量化位数**、**声道数目**、**使用的压缩编码方法**以及**比特率**；
- 比特率也称为**码率**，它指的是**每秒钟的数据量**。

##### 数字音频**未压缩**前，码率的计算公式
**波形声音的码率=取样频率 x 量化位数 x 声道数（单位：b/s）**
*注意： 压缩编码后的码率则为压缩前的码率除以压缩倍数（压缩比）。* 

##### 常用的数字音频的文件格式、编码格式以及它们的主要应用
![image-20210202185644651](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210202185644651.png)

##### 数字视频压缩编码的国际标准及其应用
![image-20210202190048228](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210202190048228.png)

##### 数字视频及其伴音的文件格式
- 国际标准**MPEG**格式（ .dat、.mpg、.mpeg、**\.mp4**、.vob、**\.3gP**、.3g2等）。
- 微软公司的AVI（**\.avc**）和ASF（**\.asf**）格式（后者适合**流媒体应用**）。
- 苹果公司的QTFF格式（**\.mov**和.qt）。
- DivX公司的DivX（.divx）格式。
- Real Network公司的RM（**\.rm**）和RMVB（**\.rmvb**）格式（ .rmvb格式是.rm的扩充，它采用H.264/MPEG-4 AVC算法， 增加了可变码率编码的功能，性能优于DivX和Xvid目前互联网上许多视频都是RMVB格式）。
- Adobe公司的FLV（.flv）和F4V（**\.f4v**）格式以及开放源代码的Matroska格式（.mkv）等。
- 说明：**\.asf、\.wmv、\.mov、\.rm、\.rmvb、\.flv和\.f4v等均支持流式传输** ，能很好地在互联网上进行音频/视频流的实时传输和实时播放，满足互联网上视频直播、视频点播、视频会议等应用的需求，得到了广泛的应用。

### 考点8 数字通信

#### 1、模拟通信与数字通信

##### 通信的基本任务与三要素
- 通信的基本任务是**传递信息**，至少需由3个要素组成：信息的发送者（称为**信源**）、信息的接收者（称为**信宿**）和携带了信息的电（或光）信号以及信息的传输通道（称为**信道**）。

##### 通信系统中所传输的信息形式
- 通信系统中所传输的信息必须以**电（或光）信号**的形式才能通过传输介质进行传输。电（或光）信号有两种形式：**模拟信号**和**数字信号**
- 模拟信号：通过**连续变化的物理量**（如电平的长度或电流的强度）来表示信息，例如人们打电话或者播音员播音时，声音经话筒（麦克风）转换得到的电信号就是模拟信号；
- 数字信号：它的**电平高低**或电流大小只有**有限个状态**（一般是两个状态），它们在时间上有时也是不连续的。例如 电报机、传真机和计算机发出的信号都是数字信号
- 说明：由于模拟信号在传输过程中容**易受噪声信号的干扰**，所以**传输质量不稳定**。目前最常用的通信方式是数字通信技术，既把模拟信号转换成数字信号后再进行传输（或信源本身发出的就是数字信号）。数字通信的实例：**手机**通信、数字**有线电视**（或卫星电视）和固定电话中继通信（及**长途通信**）等。 

#### 2、有线与无线通信

##### 通信传输介质类型、特点和应用
- 有线通信中使用的传输介质是**金属导体**或**光导纤维**，金属导体利用电流传输信息，光导纤维通过光波来传输信息。
- 无线通信根本不需要物理连接，而是通过**电磁波**在自由空间的传播来传输信息。
![image-20210203192630244](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210203192630244.png)

##### 有线通信
- 通信中使用金属电缆（**双绞线和同轴电缆**）的历史已经很长，**技术相当成熟**；
- 目前光纤已经远超金属电缆的性能，光纤是**光导纤维**的简称，它由纤芯和包层组成，包层外有涂覆层，为光纤提 供物理保护，屏蔽外部光源的干扰；
- 光纤传输的优点：通信**容量大**、传输**距离远**、抗辐射能力强、**保密性强**以及重量轻便于运输和建设；

##### 无线通信
- 优点：允许终端设备在一定范围内**自由移动**；*灵活性好。*
- 缺点：传输效率低、**易被窃听和易受干扰**；*安全性差。*
- 按频率分类：中波、短波、超短波和微波等波段；
- 适用范围：**中波**主要沿地面传播，绕射能力强，适用于**广播**和海上通信。**短波**具有较强的电离层反射能力，适用于**环球通信**。超短波和**微波**的绕射能力较差，只能作为视距或超视距中继通信；*微波是数字通信的主流。*

##### 微波的应用实例
- 微波是一种**300MHz~300GHz**的电磁波，它具有**类似光波**的特性，在空间主要作**直线传播**（*视距传播*）。利用微波进行远距离通信时，需要依靠地面微波站进行**接力通信**，微波站的中继距离一般为**50Km**左右。微波通信的另一种途径是借助**人造卫星**进行接力通信，此时中继站就安装在通信卫星上，这种通信方式也称为**卫星通信**。
- **手机**是微波最有代表性的一种应用。
  - 第1代个人移动通信采用的是模拟传输技术；
  - 第2代，使用的频段扩至**900MHz到1800MHz**多年来我国广泛使用的GSM和CDMA都是第2代移动通信系统，俗称全球通移动通信系统，简称2G；
  - 第3代个人移动通信，3G的频谱利用率比2G高，使用的频段也成倍增长（1885\~2025MHz，2110\~2200MHz）因此数据传输能力比2G大幅度提高；
  - 第4代移动通信，4G传输速率可达100Mb/s 。中国移动采用TD-LTE制式，其4G手机将兼容3G（TD-SCDMA）和2G（GSM）模式；中国电信和联通采用FDD-LTE制式，其终端设备（手机、上网卡等）也采用多模工作方式，即分别与原先使用的3G和2G模式保持兼容；
  - 5G，发展中。

#### 3、数字通信的传输技术

##### 调制与解调技术
- 信息传输时，利用信源信号去调整（改变）载波的某个参数（幅度、频率或相位），这个过程称为**调制**；
- 经过调制后的载波携带着被传输的信号在信道中进行长距离传输；到达目的地时，接收方再把载波所携带的信号检 测出来恢复为原始信号的形式，这个过程称为**解调**。

##### 多路复用技术
为了提高传输线路的利用率，降低通信成本，一般总是让多路信号同时共用一条传输线进行传输；分为如下两种：
- **时分多路复用（TDM）**，技术中各通信终端（如电话机）以事先规定的顺序轮流使 用同一传输线路进行信号（或数据）传输。
- **频分多路复用（FDM）**，它将每个 信源发送的信号调制在不同频率的载波上， 通过多路复用器将它们复合成为一个信号，然后在 同一传输线路上进行传输。
  - **波分多路复用（WDM）**，它是频分多路复用技术的一种。

##### 交换技术
- **电路交换**的特点是：在通话的全部时间内用户始终占用端到端的传输信道。
  - *电话交换机*采用的是电路交换技术。即通话前经过拨号接通双方的线路（建立一条物理通路），通话后再释放（拆线）。
- **分组交换**的特点是：电路交换的使用效率太低，解决的方法是采用分组交换（也称包交换）。它的优点是大大**提高传输线路的利用率**；同时也存在缺点，产生额外开销。
  - *路由器*

### 考点9 计算机网络

#### 1、计算机网络的组成与类型

##### 计算机网络的概念
- 计算机网络是利用*通信设备*、*传输线路*和*网络软件*，把地理上分散的许多计算机及其他智能设备**以相互通信和共享资源为目的**连接起来的一个系统。它是一种**数据通信系统**。

##### 计算机网络的组成
- **计算机等智能电子设备**
  - 它是网络的**通信终端**，如手机、电视机顶盒、监控报警设备、厨房卫生设备等；
- **数据通信链路**
  - 用于数据传输的双绞线、同轴电缆、光缆，以及为了有效而可靠地传输数据所必需的各种通信控制设备（如网卡、集线器、交换机、调制解调器、路由器等），它们构成了计算机与通信设备、计算机与计算机之间的数据通信链路；*有限设备与无线设备*
- **通信协议**
  - 为确保网络的互联互通，计算机和通信控制设备必须**共同遵循一组规则和约定**，这些规则、约定或标准就称为通信协议，简称**协议**；
- **网络软件**
  - 通信软件的功能就是**实现网络通信协议**，它们一般都包含在操作系统中。还**包括网络应用**，如电子邮件程序、浏览器程序、即时通信软件、网络游戏软件等。

##### 计算机网络的类型
- 按使用的传输介质可分为有线网和无线网；
- 按网络的使用性质可分为公用网和专用网；
- 按网络的使用范围和使用对象可以分为企业网、政府网、金融网和校园网；
- 更多的情况下，人们按网络所覆盖的地域范围把计算机网络分为：
  - **广域网**（WAN）
    - 也称为远程网，网络的作用范围可以从几十到几千km甚至更大。广域网往往覆盖一个国家、地区，或横跨几个洲，形成国际性的计算机网络。
  - **城域网**（MAN）
    - 也称为市域网，其作用范围为5~50km。
  - **局域网**（LAN）
    - 网络的地域范围较小（如几km）通常是一幢楼房、一个楼群或一个小区局域网往往属于一个单位所有，由单位自建自管；
  - **个域网**（PAN）
    - 一般指个人域网。是指能在便携式消费电器与通信设备之间进行短距离通信的网络，其覆盖范围一般在10m半径以内。

#### 2、以太局域网

##### 以太局域网的概念
- **以太局域网**常见于公司、学校、机构和家庭，是计算机网络中最流行的一种形式，全世界估计有几百万个计算机局域网；现在流行的是使用交换机组成的交换式以太网。

##### 计算机局域网的主要特点
1. 为一个单位所拥有，**自建自管**，**地理范围有限**。
2. 使用**专门铺设的传输介质**进行联网和数据通信。*主要是双绞线*
3. 数据**传输速率高**（10Mb/s\~10Gb/s），**延迟时间短**，**误码率低**（10<sup>-8</sup>\~10<sup>-11</sup>）。

##### 局域网使用的数据交换技术与数据格式
|                 |                 |          |                        |          |
| :-------------: | :-------------: | :------: | :--------------------: | :------: |
| 发送设备MAC地址 | 接收设备MAC地址 | 控制信息 | 有效载荷（传输的数据） | 校验信息 |

##### 局域网的划分
- 按照它所使用的**传输介质**
  - 有线网和无线网；
- 按照网络中终端设备互联的拓扑结构
  - 星型网、环型网、总线型网、混合型网等；
- 按照传输介质所使用的**访问控制方法**
  - 以太网、FDDI网和令牌网等。
  - 不同类型的局域网采用不同的通信协议。目前广泛使用的是**以太网**，它以**集线器或交换机**为中心构成。

#### 3、无线局域网

##### 无线局域网的概念
- 无线局域网（WLAN）是**以太网**与**无线通信技术**相结合的产物。它借助无线电波进行数据传输，工作原理与有线以太网基本相同。
- 无线局域网最大的优点：能方便地移动计算机的位置或改变网络的组成。
- 无线局域网借助**无线电波进行传输** ，使用的无线电波， 主要是**2.4GHz和5.8GHz**两个频段。*注意单位*
- 无线局域网采用的协议主要是**IEEE 802.1**（俗称**WiFi**）。*包括802.1a、802.1b、802.1g和802.1n等，其中IEEE 802.1n协议已经将传输速率进一步提高到108Mb/s甚至更高*

##### 无线局域网的构建
- 无线局域网需使用**无线网卡**、**无线接入点**等设备构建。无线接入点也被称为“**热点**”它就是一个无线交换机或无线 , 相当于**手机通信中的基站** 。
- 构建无线局域网的另一种技术是**蓝牙**。它是一种**短距离、低速率、低成本**的无线通信技术，其目的是去掉手机、平板电脑等移动终端设备之间以及它们与一些附属装置（如耳机、鼠标等）之间的连接电缆，构成一个操作空间在几m范围内的无线个人区域网络。 

### 考点10 互联网

#### 1、IP协议与路由器
- 要想极大地发挥网络的作用又必须把许多**同构或异构**的网络互相连接起来，这就必须解决诸如计算机**统一编址**、**数据包格式转换**等一系列问题。解决这些问题的途径是使用**TCP/IP协议中的IP协议**（网络互连协议）和**路由器**（router）

##### IP地址
- TCP/IP协议中的IP协议定义了主机的概念，是指任何按照TCP/IP协议连接到网络的终端设备。如PC机、手机、平板电脑，也可以是服务器或网络打印机等其他设备；**所有主机**使用一种**统一格式**的地址（简称IP地址 ）进行**标识**。
-  IP协议第4版（简称IPv4） 规定，每个IP地址使用**4B**(*32个二进制位* ）表示，其中包含有**网络号**和**主机号**两部分。 前者用来指明主机所从属的物理网络的编号（称为网络号），后者是主机在所属物理网络中的编号（称为主机号）。
- 一个IP地址可有4个十进制数来表示，每个十进制数对应IP地址中的一个字节，十进制数之间采用小数点予以分隔， 这种方式被称为**“点分十进制”**；
- 一个 /6 地址可分为**A类、B类、C类**3个基本类。**C类网络地址数量较多**，适用于小规模的局域网络，每个网络最多只能包含**254**台计算机。另有两类分别作为**组播**地址和**备用**地址（D类和E类）。
- IP中地址长度仅为32位，只有**大约36亿个**地址可用。 **2011年年初**国际组织ICANN宣布地址**已全部分配完毕**。 新的**IPv6**协议已经把IP地址的长度扩展到128位，几乎可以不受限制地提供IP地址。 

##### IP数据报
- 互联的各个物理网络，它们使用的数据包（或帧）的格式可能互不兼容，因此不能将一个网络送来的包直接传送给另一个网络。为了**克服这种异构性**，IP协议定义了一种独立于各种物理网的数据包的格式，称为IP数据报。

##### IP数据报的组成
- IP数据报由两部分组成：**头部**和**数据区**
- **头部信息**： 为了确定在网络中进行数据传输的路由，内容包括：
  - *发送*数据报的终端设备的IP地址；
  - *接收*数据报的终端设备的IP地址；
  - IP协议的*版本号*（目前大量使用的还是IPv4）
  - *头部长度*（以32位为单位指出数据报头部的长度〉；
  - *数据报长度*（整个数据报的长度，即头部长度加上数据区的长度）；
  - *服务类型*（指明发送方设备对数据传输的要求，例如，希望以低延迟方式传输，或者以高速率方式传输等）。 
- **数据区**： 数据区的长度可以根据应用而改变，数据量最小的时候也许只有1B（例如传送键盘上输入的一个字母），最大的时候可以达到64KB（包括头部信息在内）。 
- 说明：所有需要在TCP/IP网络中传输的数据在**IP这一层面**都必须**封装或分拆**成**IP数据报**之后才能进行发送或接收。

##### 路由器
- 路由器是遵循IP协议把**异构网络**互相连接起来的**关键设备**，它屏蔽了不同网络的技术差异，能将发送设备的数据**正确送达**接收设备，确保了各种不同物理网络的无缝连接。
- 路由器是一台高性能的**嵌入式计算机系统**，也是一种分组（IP数据报）交换机，其功能主要是**选择路由**和**转发IP数据报**，并进行**协议转换**。
- 路由器有**多个输入端口**和**多个输出端口**， 路由器之间一般都使用**高速通信链路**连接，一个路由器可以有多个IP地址。
- 主要作用：将一个大型网络分割成多个子网络，**避免产生广播风暴**，平衡网络负载，提高网络传输效率。路 由器能监视用户的流量，过滤特定的IP数据报，对保障网络安全也有重要作用。路由器还可以通过优先权控制、 预约网络带宽等措施提供一些网络特殊服务。

#### 2、互联网及其组成

##### 互联网的概念
- 因特网（Internet）指的是在美国ARPA网基础上通过采用TCP/IP协议连接其他计算机网络发展而成的世界上最大的一个互联网络，通常称为“互联网”。
- 互联网使用TCP/IP协议通过路由器将遍布世界各地的计算机网络互联成为一个超级计算机网络。

##### 互联网的组成
- 互联网早先的结构分为三级：**主干网、地区网和校园网**，三级网络覆盖了全美主要的大学和研究所。
- 目前互联网已经逐渐形成了**基于ISP（互联网服务提供商）的多层次结构**。
  - 最高级别的第1层ISP的服务面积最大，一般能覆盖*国家范围*；
  - 第2层ISP和一些*大公司*都是它们的用户；
  -  第3层ISP又称为本地ISP，它们只拥有本地域范围的网络，*普通的校园网*和*企业网*以及*家庭和个人*都是第3层ISP的用户。
- 互联网服务提供商ISP通常拥有自己的通信线路，也拥有从互联网管理机构申请得到的许多IP地址。用户的计算机若要接入互联网，必须获得ISP分配的IP地址。

#### 3、互联网的接入

##### 我国的互联网的接入情况
- 大量的局域网和个人计算机用户需要接人互联网。目前我国中心城市普遍采用的做法是，由**城域网的运营商（**中国电信、中国移动、中国网通等）作为ISP来承担互联网的用户接入任务；
- 城域网的主干是采用**光纤传输**的高速宽带网，它一方面与国家主干网连接，提供城市的宽带IP出口，另一方面又汇聚着若干接入网；单位用户和家庭用户可以通过**电话线、有线电视电缆、光纤、无线信道**等不同技术所组成的接入网接入城域网，再由城域网接入互联网。

##### ADSL接入的概念
- 通过固定电话的本地环路（用户线）接人互联网的技术中，最有效的一种是不对称数字用户线（ADSL）它利用**普通电话线**作为传输介质，只需在线路两端加装ADSL设备（**专用**的ADSL Modem）即可实现数据的高速传输。
- 标准ADSL的数据上传速度一般只有64\~256kb/s最高达1Mb/s，而数据下行速度在理想状态下可以达到8Mb/s（通常情况下为1Mb/s或2Mb/s左右）。有效传输距离一般在**3\~5km**。

##### ADSL接入的特点
1. 一条电话线可同时接听、拨打电话并进行数据传输，两者互不影响。
2. 虽然使用的还是原来的电话线，但ADSL传输的数据并不通过电话交换机，所以ADSL上网**不需要缴付额外的电话费**。
3. ADSL的数据传输速率是根据线路的情况自动调整的，它以“尽力而为”的方式进行数据传输。
4. 它为下行数据流提供比上行数据流更高的传输速率，适应大多数用户的使用要求。 

##### 有线电视网接入
- 有线电视系统已经广泛采用**光纤同轴电缆混合网**（HFC）传输电视节目。HFC主干线部分采用光纤连接到小区，然后在“最后1公里”时使用同轴电缆以树型总线方式接入用户居所。
- HFC具有很大的传输容量，很强的抗电子干扰能力，它融数字与模拟传输技术于一身，既能传输较高质量和较多频 道的广播电视节目，又能提供高速数据传输和信息增值服务，还可以开展交互式数字视频点播服务。
- 主机端仍采用传统的以太局域网技术与**电缆调制解调器**（Cable Modem）连接，后者通过**同轴电缆**接入HFC。Cable Modem的原理是将同轴电缆的整个频带（大约为5~750MHz）划分为三部分，分别用于数据上传、数据下传及电视节目的下传， 数据通信与电视信号的传输互不影响，上网时仍可收看电视节目。

##### 光纤接入
- 光纤接入指的是使用**光纤**作为主要传输介质的互联网接入系统。
- 在ISP的交换局一侧，应把电信号转换为光信号，以便在光纤中传输，到达用户端之后，要使用光网络单元把光信号转换成电信号，然后经过交换机传送到用户的计算机。
- 光纤接入网按照主干系统和配线系统的交界点 光网络单元的安装位置可划分为：光纤到路边（**FTTC**）、光纤到小区（**FTTZ**）、光纤到大楼（**FTTB**）、光纤到家庭（**FTTH**）等几类。

##### 目前采用无线方式接入互联网的主要技术
|         接入技术         |      使用的接入设备      | 数据传输速率 |                         说明                         |
| :----------------------: | :----------------------: | :----------: | :--------------------------------------------------: |
|  无线局域网接入（WLAN）  | WiFi无线网卡，无线接入点 |  11~100Mb/s  |     必须在安装有接入点（AP）的热点区域中才能接入     |
| GPRS移动电话网接入（2.5G） |       GPRS无线网卡       |  56~114kb/s  | 方便，有手机信号的地方就能上网，但速率不高、费用较高 |
|            3G            |        3G无线网卡        |    几Mbps    |                       速率不高                       |
|            4G            |        4G无线网卡        | 100~1000Mbps |                   主流移动通信技术                   |
|            5G            |                          |     Gbps     |                        发展中                        |

<!-- ![image-20210204232536305](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210204232536305.png) -->

## 第二章-嵌入式处理器

### 考纲与考点分析 

#### 嵌入式处理器
1. 嵌入式处理器的结构、特点与分类（不同类型的典型嵌入式处理器及其特点，嵌入式处理器分类）；
2. ARM处理器内核的体系结构（工作状态，工作模式，寄存器组织，异常，数据类型与存储格式等）；
3. 典型ARM处理器内核（ARM9，Cortex-A，Cortex-R，Cortex-M等的技术特点与应用领域）；
4. ARM处理器指令系统及汇编语言程序设计（指令格式，寻址方式，指令集，伪指令，语句格式与程序结构，ARM汇编语言与C的混合编程等）。

#### 考点分析
- 在考试中一般情况下会出现在*选择题和操作题（知识类型为记忆型和理解型相结合，记忆型偏多）*
- 常考知识点有：
  - 嵌入式处理器的结构类型。
  - 典型ARM处理器。
  - ARM处理器的体系结构
  - ARM处理器指令集
  - ARM汇编语言程序设计

### 考点1 嵌入式处理器的结构类型

#### 1、分类方式

##### 嵌入式处理器的结构类型的4种分类方式
1. 按**指令集**划分
   **CISC**（复杂指令集结构）和**RISC**（简单指令集结构）
2. 按**存储机制**划分
   **冯洛伊曼结构**和**哈佛结构**
3. 按指**字长**划分
   **8**位，**16**位，**32**位，**64**位
4. 按**不同内核**划分
   51，AVR，PIC，MSP430，PowerPC，MC68K，ColdFire和ARM

#### 2、CISC处理器和RISC处理器

##### 指令集的概念
- 也称为指令系统，它与程序设计密切相关。内容包括：基本数据类型、寄存器、寻址模式、指令、中断、 异常处理以及外部I/O等，它是**设计处理器的主要依据**，常常被称为**指令集体系结构**或**ISA架构**

##### RISC处理器的特点及应用
- 指令**数目较少**，指令**字长统一**，**格式规整**，**寻址模式较为单纯**，指令**操作简单**，**执行时间短**（*流水线方式*），大多能在**1个周期内**完成。
- 指令系统小，一个时钟周期内可以执行一条或者多条指令，采用标准长度指令，指令格式规范，寻址模式较为简单，存储器访问只是用加载和存储两个指令，采用硬布线逻辑控制为主。
- 目前常见的RISC处理器包括：ARC、**ARM**、AVR、**MIPS**、PA-RISC、Power-PC和SPARC等

##### CISC处理器的特点
- 指令集中指令**数目很多**且**结构比较复杂**，它包含许多很少使用的专用指令，不同指令的**长度并不相等**，执行**时间也长短不一**。CISC处理器结构复杂，功耗较大。
- 目前常见的CISC处理器包括VAX、PDP-11、**intel x86**等。

#### 3、冯洛伊曼存储结构和哈佛结构

##### 冯洛伊曼存储结构和哈佛结构图示
![image-20210209221444168](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210209221444168.png)

##### 冯洛伊曼存储结构和哈佛结构的不同之处
1. CPU连接程序存储器与数据存储器的方式不同
2. 与冯洛伊曼结构相比，哈佛结构的特点如下：
   - 使用*两个独立的存储器*分别存储指令和数据，不允许指令和数据并存
   - 使用*独立的两条总线*，分别作为CPU与每个存储器之间的专用通信路径，而这两条总线之间毫无关联

### 考点2 嵌入式处理器简介

##### 不同典型嵌入式处理器简介
<!-- | 内核系列 |      推出公司      |         内核结构         |                           简单描述                           |
| :------: | :----------------: | :----------------------: | :----------------------------------------------------------: |
|    51    |       Intel        |    CISC<br />哈佛结构    | 8位字长，常用于简单的检测与控制应用领域，最早被称为单片机。其价格低，应用资料全，开发工具便宜， 开发周期短，开发成本低，因此被广泛应用到各个行业。随着1T（单周期）改进型51内核的推出，加上许多器件厂家增加了自己的特色组件，因此51系列仍在生产和使用 |
|   AVR    |       Atmel        |    RISC<br />哈佛结构    | 8位、16位和32位三类字长的微控制器内核，以适应不同应用层次的要求。**AVR主要特点是高性能、高速度、低功耗** |
|   PIC    |     Microchip      |    RISC<br />哈佛结构    | 8位、16位和32位三类不同字长的RISC微控制器内核，以适应不同层次的应用要求。基于pic内核的芯片非常多，每个领域都有多款PIC芯片，主要针对工业控制应用领域，应用最广的是电机控制、汽 车电子等抗干扰要求比较高的场合。pic的主要优势是针对性强，特别是抗干扰能力强 |
|  MSP430  |         TI         |    RISC<br />哈佛结构    | 16位字长的微控制器内核，既集成了数字电路，也集成了模拟电路。广泛应用于手持设备嵌入式应用系统 中，突出特点就是以超低功耗著称全球 |
|   MIPS   |        MIPS        |  RISC<br />冯洛伊曼结构  | 高性能、高档次32位（MIPS32）和64位（MIPS64）处理器内核，主要特点是适应于高速、大数据吞吐量应用场合。中国科学院计算技术研究所的龙芯芯片已获得MIPS处理器IP的全部专利和总线、指令集的授权 |
| PowerPC  | Apple,IBM,Motorola |    RISC<br />哈佛结构    | PowerPC是含有32位子集的64位高性能处理器内核。具有优异的性能、较低的能耗以及较低的散热量。有32个（32位或64位）GPR（通用寄存器）以及各种其他寄存器。有些PowerPC CPU还有32个64位FPR（浮点寄存器）。所有PowerPC（包括64位实现）都使用定长的32位指令 |
|  MC68K   | Motorola,Freescale |    RISC<br />哈佛结构    | 32位字长的处理器内核，具有超标量的超级指令流水线，性能优势明显，主要应用在高端嵌入式应用领域 |
| ColdFire |     Freescale      |    RISC<br />哈佛结构    | 32位的高性能微控制器内核。其性能优越，集成度高，可应用于工业控制领域、消费电子领域、医疗电子领域、测试与测量领域等 |
|   ARM    |        ARM         | RISC<br />多数为哈佛结构 | 除64位Cortex-A外，均为32位结构的嵌入式处理器内核。它是目前嵌入式处理器的领跑者，是最具优势的嵌入式处理器内核。从低端到高端，应用非常广泛，是全球应用最广、 知名度最高、使用厂家最多的嵌入式处理器内核 | -->

![image-20210209222611878](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210209222611878.png)

### 考点3 ARM处理器概述

#### 1、ARM处理器的主要特点

##### ARM处理器的主要特点
- 主流ARM为32位处理器。
- 与其他处理器相比，主要特点有**耗电少**、**功能强**、**成本低**、**32位和16位指令集并存**，它具有众多的合作伙伴，使用面非常广泛，是其他处理器所不及的。

##### ARM具有的技术特征
- **单周期操作**；*一个周期完成一条指令*
- 只使用**加载/存储（Load/Store）**指令访问内存；
- 指令**长度固定**；*RISC处理器指令集特点*
- **三地址**指令格式；
- 指令**流水线技术**；
- **低功耗**设计。

#### 2、ARM处理器架构的发展

##### ARM不同版本ISA架构的比较
![image-20210211144956355](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210211144956355.png)

#### 3、ARM处理器指令集的比较
|    指令集     |                             特点                             |
| :-----------: | :----------------------------------------------------------: |
|   ARM指令集   | 全部是**32位的指令**，其基本指令主要用于进行8位、16位和32位整数的运算，通过扩展的协处理器（最多16个），可以扩充**浮点运算指令**、**DSP指令**、**SIMD指令**等，使处理器的功能大大扩展。 |
|  Thumb指令集  | 从ARMv4T架构开始，几乎所有ARM处理器都支持Thumb指令集。Thumb全部是**16位**的指令，可以看作是Thumb指令的压缩形式。 |
| Thumb-2指令集 | Thumb-2指令集既有**16位**指令又有**32位**指令，是一个**混合的指令集**。它是16位Thumb指令集的超集，功能强大、完备，效率高。 |

### 考点4 典型ARM处理器
- ※理解和区分处理器核（Processor Core）和处理器（Processro）的差异

#### 1、ARM处理器的分类
- ARM处理器分为**五类**：**经典**ARM处理器、 ARM Cortex**嵌入式处理器**、 ARM Cortex**实时嵌入式处理器**、 ARM Cortex**应用处理器**以及ARM**专家处理器**。
- ARM Cortex处理器包括：
  - Cortex-A（Application）系列是**面向高端应用**的处理器，它的工作频率高、性能好、功耗合理。这类被称为ARM Cortex应用处理器，简称**应用处理器**。*A5\~A15为32位，A53\~A57为64位*
  - Cortex-R（Real Time）系列是**面向实时控制应用**的处理器，响应速度快、性能合理、功耗低。这类被称为ARM Cortex实时嵌人式处理器，简称**实时嵌入式处理器**。
  - Cortex-M（Microcontroller）系列是**面向微控制器**的处理器，性价比极高、成本很低、功耗极小。这类被称为ARM Cortex嵌入式处理器，简称**嵌入式处理器**。

#### 2、经典ARM处理器介绍
- 经典ARM处理器目前主要有**ARM7、ARM9和ARM11**三个系列。
- **低端**的ARM7系列的ARM7TDMI（ARM7TDMS-S）是市场上销量最高的32位处理器内核，它采用ARMv4T架构，支持ARM/Thumb指令集，使用**冯氏存储结构**，由**3级指令流水线**实现，曾用于*诺基亚6110手机*。
- ARM9系列处理器，它为**微控制器、DSP和Java应用**提供了单处理器解决方案， **非常适合需要有数字信号处理功能的微控制器应用领域，经典产品为ARM920T**。
  - ARM920T处理器使用的核是ARM9TDMI，它基于**ARMv4T架构**设计，支持ARM/Thumb指令集，具有快速乘法器；采用程序与数据分离的**哈佛存储结构**，指令Cache和数据Cache各16KB，还可通过总线外接Cache和SRAM存储器；支持协处理器；含有内嵌的在线仿真模块ICE、支持片上调试；采用**5级流水线**以提高处理器性能，每一条指令的执行分为5个步骤： **①取指令，②指令译码，③执行指令运算，④ 存储器访问，⑤结果写回寄存器**。

### 考点5 ARM Cortex处理器

#### 1、Cortex-M嵌入式处理器
- Cortex-M系列目前包括Cortex-M0、M0+、M1、M3、M4共5款处理器。Cortex-M处理器都是32位RISC处理器，采用流水线技术，只支持Thumb-2指令集的子集。 
- **CM0和CM0+成本低** 、简单易用，适合成本控制要求高的**中低端应用**；
- **CM3**性能高，通用性好，适合**工业控制及中高端应用**；
- **CM4**具有有效的数字信号控制功能，适合**数字信号处理要求高的应用**。

##### Cortex-M0（CM0）
- ARM Cortex-M0处理器是市场上现有的体积最小、能耗最低的ARM处理器。CM0的处理器核基于ARMv6M架构（是ARMv7M架构的子集），它仅有56条Thumb-2指令，用户很容易掌握，开发比较简单。
- ![image-20210211162009262](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210211162009262.png)
- 说明：以该处理器为内核的MCU和SoC可广泛应用于**医疗**器械、电子测量、照明、**智能控制**、游戏装置、紧凑型电源、**电源和电机控制**、精密模拟系统和无线通信等领域中。

##### Cortex-M3（CM3）
- Cortex-M3是一款**低功耗处理器内核**，具有门数目少、中断延迟短、调试成本低的特点，是为要求有快速中断响应能力的深度嵌入式应用而设计的。
- CM3处理器系列的低功耗、低成本和易于使用的优点相结合，旨在满足专门面向**电动机控制、汽车、电源管理、嵌入式音频和工业自动化市场**的灵活解决方案。 **支持Thumb-2指令集的子集**，有**硬件除法指令**。
- ![image-20210211162205122](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210211162205122.png)

#### 2、Cortex-R实时嵌入式处理器
- Cortex-**R实时嵌入式处理器**属于**中档**处理器，它提供的性能比Cortex-M系列高得多，而Cortex-A系列则性能更高，专用于需要运行复杂操作系统（需使用虚拟内存管理）的**面向用户**的应用。
- Cortex-R处理器系列目前有Cortex-R4、Cortex-R5和Cortex-R7等品种，它们适用于**计算复杂、实时性要求苛刻**（如汽车电子、硬盘驱动器控制、手机等）的领域。
- Cortex-R处理器主要特点是：**高性能**、**实时处理**、**安全**和**低成本**。
- Cortex-R4的结构组成：
  - 其核心是采用ARMv7R架构的处理器核，它支持ARM/Thumb-2指令集，代码密度高；
  - 使用硬件实现**SIMD**（单指令多数据）的DSP指令；
  - 具有**可选的浮点运算器**（处理器型号为Cortex-R4F）；
  - 使用**8级流水线**技术实现。

#### 3、Cortex-A应用处理器
- Cortex-A应用处理器，该处理器系列适用于有**高计算要求、需运行功能丰富的操作系统以及要求提供交互媒体和图形显示**的应用领域 。例如最新的移动互联网终端（**智能手机**、上网本或智能本等）、汽车电子娱乐系统和下一代数字电视机等。美国Apple公司的*iPhone、iPad、iPod*和韩国三星电子的*Samsung Galaxy*手机等产品所使用的SoC芯片中，大多都采用Cortex-A处理器作为其CPU内核。
- Cortex-A处理器除了**A50系列为64位字长**，采用ARMv8A架构外，**其他均为32位字长**，包括Cortex-A17、A15、A12、A9、A8、A7、A5处理器，它们使用基于ARMv7A架构的处理器核，支持传统的ARM、Thumb指令集和高性能紧凑型Thumb-2EE指令集，具有完全的应用兼容性。
- Cortex-A处理器提供**Java字节码加速执行**的Jazelle技术；提供可信计算的Trust Zone安全扩展；采用最多可达**13级**的深度流水线技术，处理器时钟频率可达2GHz左右。
- Cortex-A处理器可以运行的操作系统和软件平台有：**Android**、Adobe Flash、Java SE、Java FX、Linux、Microsoft Windows Embedded、Symbian和**Ubuntu**等

### 考点6 ARM处理器的工作状态及工作模式

#### 1、ARM处理器的工作状态及其切换

##### ARM处理器的三种工作状态
1. **ARM状态**：ARM状态是ARM处理器工作于**32**位指令的状态，即32位状态，所有指令均为32位宽度
2. **Thumb状态**：Thumb状态是ARM执行**16**位指令的状态，即16位状态。在Thumb模式下，指令代码只有16位，使代码密度变大，占用空间减小，提供比32位程序代码更佳的性能
3. **调试状态**：处理机**停机调试**时进入调试状态
- ①*除Cortex-M*系列处理器外，所有ARM处理器**复位后**开始执行代码时总是**只处于ARM状态**。
- ②Cortex-M处理器因为只有**Thumb-2**指令集，所以只有**Thumb状态和调试状态**两种。 

##### ARM与Thumb间的切换
1. 由ARM状态切换到Thumb状态
   通过BX指令，将操作数寄存器的**最低位设置为1**，即可将ARM状态切换到Thumb状态。如果R0[0]=1则执行BX R0指令，将进入Thumb状态。如果Thumb状态进入异常处理（异常处理要在 **ARM**状态下进行），则**当异常返回**时，将自动切换到Thumb状态。
2. 由Thumb状态切换到ARM状态
   通过BX指令，将操作数寄存器的**最低位设置为0**，即可将Thumb状态切换到ARM状态。如果R0[0]=0则执行BX R0指令，将进入ARM状态。当处理器进行异常处理时，则从异常向量地址开始执行，将自动进入ARM状态。

#### 2、ARM处理器的工作模式
- ![image-20210222155145336](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210222155145336.png)
- ARM处理器工作模式间可以相互转换，但是有条件。
  - 当处理器工作于用户模式时，除非发生异常，否则将不能改变工作模式，当发生异常时，处理器自动改变CPSR[M4:M0]的值，进入相应的工作模式
  - 当处理器工作于系统模式时，用指令向CPSR[M4:M0]写入特定的值，以进入相应的工作模式

### 考点7 ARM状态下的寄存器组织

#### 1、ARM状态下的寄存器组织

##### ARM状态下的寄存器组织
- ARM处理器共有**37**个寄存器，包括**31个通用**寄存器（*含PC*）和**6个状态**寄存器
- 工作于ARM状态下，在物理分配上寄存器被安排成部分*重叠的组*，每种处理器模式使用不同的寄存器

##### ARM处理器工作在不同模式时使用的寄存器的异同点
- 无论何种模式，**R15**均作为PC使用
- **CPSR**为当前程序状态寄存器
- **R7~R0**为公用的通用寄存器
- 不同之处在于：高端7个通用寄存器和状态寄存器在不同模式下不同

##### 不同模式下的寄存器
- ![image-20210222160850590](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210222160850590.png)
- ![image-20210222160953386](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210222160953386.png)
- ![image-20210222161007198](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210222161007198.png)

#### 2、Thumb状态下的寄存器组织
![image-20210222161139572](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210222161139572.png)


### 考点8 ARM处理器的异常
- 在程序正常执行的过程中，每执行一条ARM指令PC值加4，每执行一条Thumb指令PC值加2，通常指令按顺序正常执行。
- 异常（和中断）是由于内部事件或外部事件引起的请求，使处理器去做相应处理的事件。当发生异常时，系统执行完当前指令后，跳转到相应的异常处理程序入口执行异常处理， 异常处理完毕后程序返回。

#### 1、ARM异常种类、异常向量表及优先级
![image-20210303230715341](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210303230715341.png)
- 异常向量的地址由**32位地址空间**的低端正常地址范围0x00000000~0x0000001F决定。ARM处理器片内其他硬件组件的中断使用IRQ或FIQ
- 由上表可以看出，7种类型的异常分为6级，级别最高的是复位，最低的是未定义的指令UND或软件中断SWI。其中UND和SWI异常（包括协处理器不存在异常）是互斥的，不可能同时发生，因此优先级是最高的，并不矛盾
- 复位异常的优先级最高，因此在任何情况下只要进入复位状态，系统便无条件地将PC指向0x00000000处，去执行系统的第一条指令。通常此处放一条无条件的转移指令，转移到系统初始化程序处

#### 2、ARM异常的中断响应过程
![image-20210303231509438](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210303231509438.png)

#### 3、从异常处理程序中返回
![image-20210303231529490](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210303231529490.png)

### 考点9 ARM的存储器格式及数据类型

#### 1、ARM的两种存储字的格式
- ARM体系结构可以用两种方法存储数据字，称之为**大端模式和小端模式**。

##### 大端模式
![image-20210304185922025](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210304185922025.png)

##### 小端模式
![image-20210304190044087](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210304190044087.png)

#### 2、ARM存储器的数据类型
- ARM体系结构将存储器看作是从0x00000000地址开始的**以字节为单位**的线性阵列。每个数据字32位，占**4个字节**的地址空间。作为32位的处理器，ARM体系结构所支持的最大寻址空间为4GB(2<sup>32</sup>B)，但具体的ARM芯片不一定提供最大的地址空间
- 除Cortex-A5外，32位ARM处理器中支持**字节**(8位)、**半字**(16位)、**字**(32位)3种数据类型，其中字需要**4字节对齐**（地址的低两位为0），半字需要**2字节对齐**（地址的最低位为0）。其中每一种又支持**有符号数和无符号数**，因此认为共有6种数据类型
- ARM还支持其他类型的数据，如**浮点数**等数据类型

### 考点10 ARM处理器中的MMU和MPU

#### 1、ARM处理器中的MMU（存储器管理单元）

##### MMU的功能
- **虚拟地址到物理地址的映射**
  - ARM中MMU功能可以被“禁止”或“使能”。当“使能”MMU后，ARM处理器产生的地址是虚拟地址
  - MMU的功能就是进行虚拟地址到物理地址的转换，这需要通过**查找页表**来完成。页表是一张虚拟地址与物理地址的对应表，页表存储在内存储器中
- **存储器访问权限控制**
  - 存储器的访问权限可以以**块（页）**为单位进行设置，分为不可访问、只读、可读写等不同的权限
  - 当访问具有不可访问权限的页时，会产生一个存储器异常的信号通知ARM处理器

##### 存储器访问的顺序
- 当执行加载/存储指令要访问存储器时，**MMU先查找TLB中的转换表**
  - 如果TLB中没有，则硬件会**自动査找主存储器内的页表**，找到*虚拟地址到物理地址的转换信息和访问权限信息*就可以用来进行存储器的读写操作
  - 同时**把这些信息放入TLB中**供此后继续使用
    - 如果在页表中也找不到转换信息，则**产生中断，通知OS进行处理**

#### 2、ARM处理器中的MPU（存储器保护单元）
- MPU是对存储器进行保护的可选组件。它提供了**简单替代MMU**的方法来管理存储器，没有MMU，就不需要进行复杂的地址转换操作
- MPU允许ARM处理器的4GB地址空间定义8对域，分别控制8个指令和8个数据内存区域
- 每个域的首地址和界（或长度）均可编程
- MPU中一个区域就是一些属值及其对应的一片内存。这些属性包括起始地址、长度、读写权限以及缓存等。
- 带MPU的ARM处理器使用不同的域来管理和控制指令内存和数据内存
- 域和域可以重叠并且可以设置不同的优先级

### 考点11 ARM指令分类及指令格式

#### 1、ARM指令分类
- ARM微处理器的指令集可以分为分支指令、数据处理指令、程序状态寄存器指令、加载/存储指令、协处理器指令和异常产生指令六大类
- ![image-20210307212423720](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210307212423720.png)

#### 2、ARM指令格式

##### 指令一般格式
<code>\<opcode>{\<cond>}{S} \<Rd>,\<Rn>{,\<op2>}</code>
- 其中<>不可省，{}可省略，opcode、cond与S之间没有分隔符，{S}与Rd之间用空格隔开
- \<opcode>：**指令的操作码**；助记符
- \<cond>：**条件域**，满足条件才执行；可省略
- {S}：指令执行时**是否更新CPSR**；可省略
- Rd：**目的寄存器**；任意通用寄存器
- Rn：**第一个操作数**；任意通用寄存器，可与Rd相同
- op2：**第二个操作数**；可为imm8m、寄存器Rm及任意移位寄存器
- 关于#imm8m的说明
  - 对于ARM指令集，#imm8m表示一个由8位立即数经循环右移任意偶数次形成的32位操作数
  - 对于Thumb指令集，#imm8m表示一个由8位立即数经左移任意次形成的32位操作数

##### 指令的条件域
- 每一条ARM指令包含4位的条件码，位于指令的最高4位[31:28]
- 条件码一共有2<sup>4</sup>种，每种条件码可用两个字符表示，这两个字符可以添加在助记符后面与指令同时使用。如"REQ"可代表"相等则跳转"
- ![image-20210307214425836](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210307214425836.png)

#### 3、ARM指令中操作数符号
1. "#"：**立即数符号**；其后是十进制数或者十六进制数
2. "0x"：**十六进制符号**；其后数据每位可以是0\~9、A\~F
3. "!"：**更新基址寄存器符号**；表示指令在完成操作后最后的地址应该写入基址寄存器中
4. "^"：**复制SPSR到CPSR符号**；用于表示批量数据存储指令中放在寄存器之后作为后缀
   1. 当其前面的寄存器不包含PC时，该符号表示所用的寄存器是用户模式的寄存器
   2. 当其前面的寄存器包含PC时，该符号表示将SPSR寄存器的值复制到CPSR寄存器中
5. "-"：**表示寄存器列表范围符号**；表示多个连续寄存器

#### 4、ARM指令中的移位操作

##### 移位操作格式
<code>Rm,\<opsh>#\<shift></code>
- Rm：要移位的通用寄存器
- \<opsh>：移位操作符；LSL(逻辑左移)、LSR(逻辑右移)、ASL(算数左移)、ASR(算术右移)、ROR(循环右移)、RRX(带扩展的循环右移)
- \<shift>：移位次数（0~32）

##### 移位操作及示例
![image-20210307215920906](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210307215920906.png)

### 考点12 ARM指令的寻址方式

#### 1、立即寻址
```Assembly
MOV R0,#0x11	;R0 = 0x11
ADC R0,R0,#99	;R0 ← R0+99+C
```
- 第二个源操作数即为立即数，要求以"#"为前缀，对于十六进制表示的立即数，还要求在"#"后加上"0x"，不加"0x"表示十进制数

#### 2、寄存器寻址
```Assembly
ADD R0,R1,R2	;R0 ← R1+R2
```
- 利用寄存器中的数值作为操作数

#### 3、寄存器间接寻址
```Assembly
LDR R5,[R4]		;R5 ← [R4],间接寻址的寄存器是R4
STR R1,[R2]		;[R2] ← R1,间接寻址的寄存器是R2
```
- 以寄存器中的值作为操作数地址，而操作数本身放在存储器中。用于间接寻址的寄存器必须用"[]"括起来

#### 4、基址加变址寻址
```Assembly
LDR R0,[R1,#3]		;R0 ← [R1+3]		
STR R1,[R2,#6]		;[R2+6] ← R1
LDR R0,[R1,#3]!		;R0 ← [R1+3]、R1 ← R1+3
LDR R0,[R1],#3		;R0 ← [R1]、R1 ← R1+3
LDR R0,[R1,R2]		;R0 ← [R1+R2]
STR R0,[R1,R2]		;[R1+R2] ← R0
```
- 将寄存器（该寄存器一般称作基址寄存器）的内容与指令中给出的地址偏移量相加，从而得到一个操作数的有效地址。变址寻址方式常用于访问某基地址附近的地址单元。

#### 5、相对寻址(跳转指令)
```assembly
	BL Subrouhtine_A	 ;跳转到子程序Subrouhtine_A处执行
Subrouhtine_A
	MOV PC,LR			;从子程序返回
```
- 与基址变址寻址方式相类似，相对寻址以程序计数器PC的当前值为基地址，指令中的地址标号作为偏移量，将两者相加之后得到操作数的有效地址。

#### 6、堆栈寻址（程序调用）
- **满递增堆栈**：堆找指针指向最后压入的数据，且由低地址向高地址生成
- **满递减堆栈**：堆栈指针指向最后压人的数据，且由高地址向低地址生成
- **空递增堆栈**：堆栈指针指向下一个将要放入数据的空位置，且由低地址向高地址生成
- **空递减堆找**：堆找指针指向下一个将要放人数据的空位置，且由高地址向低地址生成

#### 7、块拷贝寻址
```assembly
LDMIA R0,[R1,R2,R5,R9]	;R1 ← [R0]、R2 ← [R0+4]、R5 ← [R0+8]、R9 ← [R0+12]
```
- 块拷贝寻址又称多寄存器寻址，采用多寄存器寻址方式，一条指令可以完成多个寄存器值的传送。
- 这种寻址方式可以用一条指令完成传送最多16个通用寄存器的值。

### 考点13 ARM指令集

#### 1、数据处理类指令

##### 数据处理类指令
- 可分为数据传送指令、算术逻辑运算指令、比较指令
- ![image-20210307223839630](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210307223839630.png)

##### ARM指令集示例
- 
```assembly
  ;数据传送指令
  MOV R1,R0		;将寄存器R0的值传送到寄存器R1
  MOV R1,R0,LSL#2	;将寄存器R0的值左移2位后传送到寄存器R1
  ```
- 
```assembly
  ;比较指令
  CMP R1,R0	;将寄存器R1的值与寄存器R0的值相减，并根据结果设置CPSR的标志位
  CMP R1,#85	;将寄存器R1的值与立即数85相减，并根据结果设置CPSR的标志位
  ```
- 
```assembly
  ;位测试指令
  TST R1,#0x01	;用于测试在寄存器R1中是否设置了最低位
  TST R1,#0xFE	;将寄存器R1的值与立即数0xFE按位与，并根据结果设置CPSR的标志位
  ```
- 
```assembly
  ;相等测试指令
  TEQ R1,R2	;将寄存器R1的值与寄存器R2的值按位异或，并根据结果设置CPSR的标志位
  ```
- 
```assembly
  ;加法指令
  ADD R0,R1,R2	 	;R0 = R1+R2
  ADD R0,R1,#256	 	;R0 = R1+256
  ADD R0,R2,R3,LSL#2	;R0 = R2+(R3<<2)
  ADCS R5,R6,R7	 	;R5 = R6+R7+C,且更新CPSR状态
  ```


#### 2、程序状态寄存器访问指令

##### MRS - 程序状态寄存器到通用寄存器的数据传输指令
- 格式：<code>MRS{cond} Rd,\<PSR></code>
  - PSR可以是CPSR或SPSR
- 用途：MRS指令主要用于将程序状态寄存器的内容传送到通用寄存器中
- 使用情况：
  - 当**需要改变程序状态寄存器的内容**时，可用MSR将程序状态寄存器的内容读入通用寄存器，修改后再写回程序状态寄存器
  - 当在异常处理或进程切换时，**需要保存程序状态寄存器的值**，可先用该指令读出程序状态寄存器的值，然后保存

##### MSR - 通用寄存器到程序状态寄存器的数据传输指令
- 格式：<code>MSR{cond} \<PSR>_\<fields>,Rm</code>
  - PSR可以是CPSR或SPSR，fields为域
- 用途：MSR指令主要用于将操作数的内容传送到程序状态寄存器的特定域中。其中操作数可以为通用寄存器或立即数
- <fields>域用于设置程序状态寄存器中需要操作的位，32位的程序状态寄存器可以分为4个域：
  - PSR[31:24]：条件标志位域，用f表示
  - PSR[23:16]：状态位域，用s表示
  - PSR[15:8]：扩展位域，用x表示
  - PSR[7:0]：制位域，用c表示

#### 3、分支指令

##### B - 转移指令
- 格式：<code>B{cond} Label</code>
  - Label为目标地址
- 用途：B指令是最简单的跳转指令。一旦遇上一个B指令，ARM处理器将立即跳转到给定的目标地址，从那里继续执行

##### BX - 带状态切换的转移指令
- 格式：<code>BX{cond} <Rn></code>
- 用途：BX指令跳转到指令中所指令的由寄存器Rn与0xFFFFFFFE相与后的结果指示的目标地址（即Rn[0]并不作为目标地址，而是作为状态切换位），目标地址处的指令既可以是ARM指令，也可以是Thumb指令

##### BL -  带返回的转移指令
- 格式：<code>BL{cond} Label</code>
- 用途：BL是带返回的跳转指令，在跳转之前，会在寄存器R14中保存PC的当前值

##### BLX -  带返回且带状态切换的转移指令
- 格式：<code>BLX目标地址</code>
- 用途：BLX指令从ARM指令集跳转到指令中所指定的目标地址，并将处理器的工作状态由ARM状态钱换到Thumb状态，该指令PC将的当前内容保存到寄存器R14中

#### 4、加载/存储指令

##### 单一数据加载/存储指令
- LDR - 字数据加载指令
  - 指令用于从存储器中将一个32位的字数据传送到目的寄存器中
- LDRB - 字节数据加载指令
  - 指令用于从存储器中将一个8位的字数据传送到目的寄存器中，同时将寄存器的高24位清零
- LDRH - 半字数据加载指令
  - 指令用于从存储器中将一个16位的字数据传送到目的寄存器中，同时将寄存器的高16位清零
- STR - 字数据存储指令
  - 指令用于从源寄存器中将一个32位的字数据传送到存储器中。
- STRB - 字数据存储指令
  - 指令用于从源寄存器中将一个8位的字数据传送到存储器中。
- STRH - 字数据存储指令
  - 指令用于从源寄存器中将一个16位的字数据传送到存储器中。

##### 批量数据加载/存储指令
- LDM - 批量数据加载指令
  - 格式：<code>LDM{cond}  mode  Rn{!}, reglist{^}</code>
  - 用途：指令用于将由基址寄存器所指示的一片连续存储器读到寄存器列表所指示的多个寄存器中，该指令的常见用途是将多个寄存器的内容出栈。
- STM - 批量数据存储指令  
  - 格式：<code>STM{cond}  mode  Rn{!}, reglist{^}</code>
  - 用途：指令用于将寄存器列表所指示的多个寄存器的数据存储到由基址寄存器所指示的一片连续存储器中，该指令的常见用途是将多个寄存器的内容入栈。

### 考点14 ARM处理器支持的伪指令

#### 1、ADR伪指令
- 格式：<code>ADR{cond} Rd,expr</code>
- 用途：用于相对偏移地址加载到通用寄存器中

#### 2、LDR伪指令
- 格式：<code>LDR{cond} Rd,= [expr]</code>
- 用途：用于一个32位常数的加载或地址的加载
- 目的：
  - 当用MOV或MNV指令无法加载符合要求的32位立即数时，可用LDR伪指令加载任意32位操作数到寄存器
  - 当需要程序的相对偏移地址或外部地址加载到寄存器时可使用LDR伪指令

#### 3、NOP - 空操作
- 格式：<code>NOP</code>
- 用途：产生所需的ARM无操作代码，用于简单延时，与<code>MOV Rd,Rd</code>等效

### 考点15 ARM汇编器所支持的伪指令

#### 1、 符号定义伪指令
- ![image-20210308124141924](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210308124141924.png)

#### 2、数据定义伪指令
- ![image-20210308124152277](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210308124152277.png)
- 
```assembly
  Str DCB "This is a test!"	;分配一片连续的字节存储单元并初始化str=This is a test!"
  DataTes DCW 1,2,3	;分配3个连续的半字存储单元并初始化位1,2,3
  ```


#### 3、汇编控制伪指令
- ![image-20210308124201271](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210308124201271.png)
- 
```assembly
  ;例1
  GBLL Test
  	IF Test = TRUE
  		指令序列1
  	ELSE
  		指令序列2
      ENDIF
  
  ;例2
  GBLA Counter
  	Counter SETA 3
  		……
  	WHILE Counter < 10
  		指令序列
      WEND
  ```


#### 4、其他伪指令
- ![image-20210308125851443](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210308125851443.png)

### 考点16 ARM汇编语言的s语句格式

#### 1、汇编语言的语句格式
<code>{标号}{指令或伪指令}{;注释}</code>
- 说明：在汇编语言程序设计中，每一条指令的助记符可以全部用大写或者全部用小写，但不允许一条指令中大小写混用

##### 符号必须遵循的约定：
- 符号区分大小写，同名的大小写符号会被编译器认为是两个不同的符号
- 符号在其作用范围内必须唯一
- 自定义的符号名不能与系统的保留字相同
- 符号名不应与指令或伪指令同名

#### 2、在汇编语言程序中的表达式和运算符

##### 运算次序遵循的优先级
- 优先级相同的双目运算符的运算顺序从左往右
- 相邻的单目运算符的运算顺序为从右到左，且单目运算符的优先级高于其他运算符
- 括号运算符的优先级最高

##### 数值表达式及运算符
- **算术**运算符：+、-、*、/、MOD
- **移位**运算符：ROL、ROR、SHL、SHR
- **数值逻辑**运算符：AND、OR、NOT、EOR

##### 逻辑表达式及运算符
- **关系**操作符：=、>、<、>=、<=、/=、<>（注意相等是一个等于号）
- **逻辑**运算符：LAND、LOR、LNOT、LEOR（加上前缀L与数值逻辑运算符区分）

##### 字符串表达式及运算符
- **返回字符串长度**运算符：LEN
- **字节整数转换为字符**运算符：CHR
- **字符串转换**运算符：STR
- **返回左端字符串**运算符：LEFT
- **返回右端字符串**运算符：RIGHT
- **合并字符串**运算符：CC

### 考点17 汇编语言的程序设计举例

#### 1、S3C2410系统引导程序代码

##### 系统引导程序的功能
- 关看门狗定时器，关中断
- 设置CPU速率及时钟频率
- 设置堆栈
- 切换用户模式并初始化用户堆找
- 如果使用DRAM或其他设备，还要设置相关寄存器，初始化这些设备
- 初始化存储空间
- 跳转到C程序入口

##### 启动文件Startup.s及其代码分析
引导程序主要是一个启动代码文件Startup.s

#### 2、顺序程序设计
- 例如，在小端模式下，执行下面START程序后，R0、R1、R2和R3的值以及内存0x30100000~0x30100003中的值是多少？
  ```assembly
  AREA EXAMPLE1,CODE,READONLY
  		ENTRY
  		CODE32
  START LDR R0, =0x12345678			;R0 = 0x12345678
  		LDR R1, =0x30100000			;R1 = 0x30100000
  		LDR R2, =0x87654321			;R2 = 0x87654321	
  		STR R2,[R1]					;[R1] = 0x87654321
  		LDR R3,[R1]					;R3 = 0x87654321
  		AND R3,R3,#0x000000FF		;R3 = 0x00000021
  		ADD R0,R0,R3,LSL#2			;R3 = 0x00000084、R0 = 0x123456FC
  		STR R0,[R1]					;[R1] = 0x123456FC
  		END
  ```


#### 3、分支程序设计
- ARM分支程序结构通常使用分支指令B加上条件执行来实现。

#### 4、循环程序设计
- **循环初始部分**：为开始循环准备必要的条件，如循环次数、循环体需要的初始值等
- **循环体部分**：重复执行的程序代码，其中包括对循环条件修改的程序段
-  **循环控制部分**：判断循环条件是否成立，决定是否继续循环（循环控制部分是编程的**关键和难点**）

##### 由计数控制循环
- 用一个通用寄存器Rn(n=0,1,2,3,4,5,6,7)作为计数器，先给初始值，然后每循环一次减1，直到循环次数为0结束循环，程序结构如下：
  ```assembly
  	MOV Rn,#Counter
  		……
  LPM	
  	SUBS Rn,Rn,#1
  	BCC LPM	
  ```


##### 由条件控制循环
- 从0x30500000开始的内存区域存放着若干字节的BCD码数据，并以0x0D结束。编程对这些数据进行累加和计算，取累加和的前面两个字节放到这个数据结束字符之后的两字节中，并把数据个数写入后一个单元中
  ```assembly
  	AREA EXAMPLE4,CODE,READONLY
  	ENTRY
  	CODE32
  MYADD	　MOV R0,#0
  	MOV R1,#0
  	LDR R2, =0x30500000
  LOPPA	LDRB R3,[R2]
  	CMP R3,#0x0D
  	BNE LOPPOUT
  	ADD R1,R1,R3
  	ADD R2,R2,#1
  	ADD R0,R0,#1
  	B LOPPA
  LOPPOUT	STRH R1,[R2]
  	STR R0,[R2+2]
  	END
  ```


#### 5、子程序设计
- 在ARM汇编语言程序中，子程序的调用一般是通过BL指令来实现的。在程序中，使用指令：<code>BL 子程序名</code>即可完成程序的调用

#### 6、多段程序设计
- 前面的例子均只釆用一个代码段，实际应用中还可以定义多个数据段。

## 第三章-嵌入式系统硬件组成

### 考纲与考点分析

#### 嵌入式系统硬件组成
1. 嵌入式硬件组成与嵌入式处理芯片（组成，特点，类型，ARM的AMBA总线，嵌入式处理芯片的选型）
2. 嵌入式系统的存储器（层次结构，分类，性能指标，片内存储器，片外存储器，外部存储器等）
3. I/O接口、I/O设备以及外部通信接口（GPIO、I<sup>2</sup>C、SPI、UART、USB、HDMI等；键盘、LED、LCD、触摸屏、传感器等；RS-232/RS-485、CAN、以太网和常用无线通信接口）
4. 基于ARM内核的典型嵌入式处理芯片（S3C2410/S3C2440芯片的内部结构，如片上总线、DMA、时钟控制、中断控制、GPIO、UART、I<sup>2</sup>C、SPI、Timer、RTC、WDT及其他硬件组件）

#### 考点分析
- 在考试中一般情况下会出现在*选择题和操作题（知识类型为记忆型和理解型相结合，记忆型偏多）*
- 常考知识点有：
  - 嵌入式最小硬件组成
  - 嵌入式处理芯片
  - 嵌入式系统的存储器
  - I/O接口及常用I/O设备
  - ARM内核典型嵌入式处理芯片
  - 嵌入式系统外部通信接口

### 考点1 嵌入式最小硬件系统

##### 嵌入式最小硬件系统的组成
- 提供嵌入式处理器运行必备条件的硬件电路与嵌入式处理器共同构成了嵌入式最小硬件系统，而大多数基于ARM处理器核的处理器芯片都有调试接口
- ![image-20210316093406916](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210316093406916.png)

#### 1、电源电路
- 电源电路为整个嵌入式硬件系统**提供能量**，是整个系统的基础，具有极其重要的地位

##### 选择和设计电源电路时主要考虑的7个因素
1. **输出的电压、电流**
   - 按嵌入式硬件系统需要的最大功率来确定电源输出功率
2. **输入的电压、电流**
   - 是直流还是交流，输入电压和电流有多大
3. **安全因素**
   - 是否需要不会因火花或热效应而点燃爆炸性环境的本安型电源
4. **电磁兼容**
5. **体积限制**
6. **功耗限制**
7. **成本限制**

##### 嵌入式系统常用的电源模块
- 交流变直流（**AC-DC**）模块
- 直流变交流（**DC-AC**）模块
- 低压差稳压器（**LDO**）模块

#### 2、时钟电路
- 几乎所有的嵌入式处理器本质上均为同步时序电路，需要**时钟信号**才能按照**节拍**正常工作。大多数嵌入式处理器内置了时钟信号发生器，因此时钟电路只需要外接一个石英晶体振荡器和两只电容就可以工作了。
- ![image-20210317080742940](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210317080742940.png)
- 上图中的Xtal为晶体振荡器，简称**晶振**。根据系统需求选择合适的晶振，既要考虑嵌入式处理器的最高工作频率，又要保证系统在一定的功耗范围内
- 晶振是**无极性**的，通常分为**无源和有源**两种，无源晶振有两只引脚X1和X2，有源晶振有四只引脚，除了X1、X2外还有电源和地，X1为输入，X2为输出，通过X2可以提供时钟源给外部的其他电路使用

#### 3、复位电路
- 嵌入式处理器都有一个系统复位引脚为**nRESET或RESET**，其中**n表示低电平复位**，**不带n的表示高电平复位**。一般来说nRESET必须至少**保持若干个处理器时钟周期的低电平**，系统才能可靠复位。目前嵌入式系统常使用外接典型复位芯片以保证系统能可靠复位
- ARM复位后PC指针指向唯一的地址0x00000000，而在此地址处通常放一条无条件转移指令<code>B RESET</code>, 转向RESET开始的系统初始化程序，在这个系统初始化程序中就可以对系统进行初始化操作，以保证系统有序工作

#### 4、JTAG测试接口
- “JTAG”是一种**国际标准测试协议**，主要用于**芯片内部测试**以及对**系统进行仿真和调试**
- JTAG技术是一种嵌入式测试技术，它在芯片内部封装了专门的测试电路并提供测试访问口（Test Access Port），TAP通过专用的JTAG测试工具可以对内部节点进行测试
- JTAG测试允许多个器件通过JTAG接口串联在一起，形成一个JTAG链，实现对各个器件分别进行测试

### 考点2 基于ARM内核的典型嵌入式应用系统硬件组成

##### 典型嵌入式应用系统硬件组成
- ![image-20210317082630449](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210317082630449.png)
- 典型嵌入式系统硬件是由**嵌入式最小硬件组成、前向通道、后向通道、人机交互通道以及相互互联通道**组成
  - *前向通道*。即输入接口，由模拟量输入接口和数字量输入接口组成，模拟输入接口包括传感器陈、信号调理电路（滤波器、放大器等）、A/D转换器等
  - *后向通道*。即输出接口，由模拟量输出接口和数字量输出接口组成，模拟输出接口包括D/A转换器、功率放大器、执行器等
  - *人机交互通道*。包括键盘或触摸屏输入接口以及LED或LCD显示输出接口等
  - *相互互联通道*。包括RS-232/RS-485串行通信接口、CAN通信接口、以太网通信接口、USB通信接口等

### 考点3 ARM的AMBA总线体系结构及标准

##### AMBA总线的概念
- AMBA，**先进微控制器总线体系结构**。是ARM公司发布的总线协议，用于连接和管理SoC中功能模块的开放标准和片上互连规范
- 标准规定了ARM处理器内核与处理器**内部高带宽RAM、DMA以及高带宽外部存储器等快速组件**的接口标准（通常称为**系统总线**），
- 也规定了内核与ARM处理器**内部外围端口及慢速设备接口组件**的接口标准（通常称为**外围总线**）。

#### 1、AMBA总线的发展及版本
- ![image-20210317083923135](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210317083923135.png)
- AMBA1总线标准规定了两种类型总线，分别为系统总线和外围总线。*ASB、APB*
  - 先进系统总线(ASB)用于连接**高性能**系统模块
  - 先进外围总线(APB)支持**低性能**的外围接口。*所有通用外设组件均连接到APB总线上*
  - ASP和APB之间通过桥接器(Bridge)相连，期望能减少系统总线的负载
- AMBA2总线标准增强了AMBA的性能，定义了两种高性能的中线规范AHB和APB2以及测试方法。*AHB、APB2*
  - ASB改成先进高性能总线(AHB)，用于连接**高性能系统组件或高带宽组件**
- AMBA3总线标准包括先进的可扩展接口(AXI)，先进的跟踪总线(ATB)，AHB-Lite以及APB3四个总线标准。*AXI、ATB、AHB-Lite、APB3*
- AMBA4总线标准在ATB的基础上增加了5个接口协议：AXI一致性扩展(ACE)、ACE-Lite、AXI4、AXI4-Lite以及AXI4-Stream。*ACE、ACE-Lite、AXI4、AXI4-Lite、AXI4-Stream、ATB、AHB-Lite、APB4*
- 不同版本的外围总线从APB到APB4的发展仅仅是所支持的外围硬件组件有所增加，其他没有什么变化

#### 2、基于AMBA总线的典型ARM片上系统
- AMBA1由**ASB+APB**组合构成总线系统
- AMBA2由**AHB+APB**组合构成总线系统
- AMBA3由**AHB+ATB+AXI+APB**组合构成总线系统
- AMBA4由**ACE+ATB+AXI（包括-Lite，-Stream）+APB**组合构成总线系统，系统总线信号经过桥接器变换成外围总线APB的信号

### 考点4 基于ARM内核的嵌入式芯片的硬件组成

##### 基于ARM内核的嵌入式芯片的硬件组成
- ![image-20210320090256437](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210320090256437.png)

#### 1、存储器及控制器
- ARM处理芯片内部硬件中除ARM内核外，最重要的组件就是**存储器及其管理组件**，用于管理和控制片内的SRAM、ROM和Flash ROM，通过**外部存储器**对外部扩展存储器如Flash存储器及DRAM等进行管理与控制
- 片内程序存储器通常使用的是**Flash ROM**，片内数据存储器通常使用的是**SRAM**
- 目前程序存储器的大多采用**Flash存储器**，数据存储器采用**SRAM和DDR或DDR2或普通的DRAM**
- 高带宽外部存储器控制接口为外部存储器扩展提供了接口，**可扩展程序存储器及数据存储器**
- 高带宽外部存储器控制接口与AMBA的系统总线**部分相连**

#### 2、中断控制器
- 中断控制器负责对其他硬件组件的中断请求进行管理和控制，一般采用**向量中断**（VIC）或**嵌套向量中断**（NVIC）方式管理中断。
- 处理中断有两种形式，分别为标准的中断控制器和向量中断控制器（VIC）
  - 标准中断控制器在一个外设设备需要服务时，发送一个中断请求信号给处理器核。
  - 中断处理程序通过读取中断控制器中与各设备对应表示中断请求的寄存器内容，从而判断哪个设备需要服务。
- VIC比标准中断控制器的功能更为强大些，**它区分中断的优先级**，简化了判断中断源的过程，只有当一个新的中断其优先级高于当前正在执行的中断处理优先级时，VIC才向内核提出中断请求
- NVIC比VIC更进一步，可以进行**中断的嵌套**，即高优先级的中断可以进入低优先级中断的处理过程中。待高优先级中断处理完成才去继续执行低优先级中断。也有人称之为**抢占式优先级中断**。*Cortex-M系列就支持嵌套的向量中断*

#### 3、DMA控制器
- ARM处理芯片内部的DMA控制器（即**直接存储器访问控制器**）是一种硬件组件，可将数据块**从外设传输至内存**、**从内存传输至外设**或**从内存传输至内存**
- 数据传输过程中**不需要CPU参与**，因此可降低处理器的负荷。通过将CPU设为低功率状态并DMA使用控制器传输数据，降低了系统的功耗
- 当ARM与串行通信端口、USB接口、CAN接口、以太网接口等通道进行交流时， **它们既可以由ARM内核控制其数据传输， 也可以通过DMA控制器控制数据传输**

#### 4、电源管理与时钟控制器
- ARM处理芯片内部的电源管理主要有**正常工作**模式、**慢时钟**模式、**空闲**模式、**掉电**模式、 **休眠**模式、**深度休眠**模式等以控制不同组件的功耗。
- 时钟信号是ARM芯片定时的关键，**时钟控制器**负责对时钟的分配，产生不同频率的定时时钟供片内各组件作为同步时钟使用。
  - 例如，有供快速通道的存储器时钟、供DMA控制器及中断控制器的时钟，也有经过桥接器之后经若 干分频得到的慢速时钟供APB总线上的各个不同接口作为同步信号。 

#### 5、GPIO
- GPIO（General Purpose Input Output）即**通用输入/输出端口**。作为输入时具有**缓冲**功能，而作为输出时则具有**锁存**功能，GPIO也可以作为**双向I/O**使用。
- 在ARM处理芯片中，GPIO引脚通常是**多功能使用**的，目的是为了减少芯片引脚数，缩小PCB面积，以减少功耗。有的引脚是双功能的，也有三功能甚至四功能的引脚，不同厂家的ARM处理芯片其具体引脚的定义不同。

#### 6、定时计数组件

##### ARM处理芯片内部的计数组件
- **WDT**（看门狗定时器）
  - WDT是能使系统定时复位的硬件或软件
  - 看门狗的主要功能是当处理器在进入错误状态后的一定时间内复位，保证系统的稳定运行
- **Timer通用定时器**
  - Timer是通用定时器，可用于一般的定时
- **RTC**
  - RTC可提供年月日时分秒，使应用系统具有自己独立的日期和时间
- **PWM**（脉冲宽度调制器）
  - PWM用于脉冲宽度的调制，比如电机控制、用于变频调整等多种场合
- 以上所有与定时有关的组件的一个共同特点就是，对特定输入的时钟**通过分频后接入计数器进行加1或减 1计数**，计数达到预定的数值后将**引发一个中断并置一定的标志位**。

#### 7、模拟通道组件

##### ARM处理芯片内部的模拟组件
- **ADC**
  - ADC是模拟到数字的转换器，可完成**从模拟信号到数字信号**的变换。对于嵌入式系统而言它是一个模拟输入的组件。ARM芯片内部只有一个变换单元，分辨率一般为10位和12位居多。
- **DAC**
  - DAC是数字到模拟的变换器，可完成**从数字信号到模拟信号**的变换。对于嵌入式系统而言它是一个模拟输出组件。一般内置DAC有10位、12位、14位等分辨率。
- **比较器**
  - 比较器可方便地**对模拟电压信号等与基准信号相比较** ，可监测电源电压、芯片温度等，通过比较采样值与基准值，就可以判断是否欠压、温度是否超高等。

#### 8、互联通信组件

##### ARM处理芯片内部的互联通信组件
- **UART**（通用异步收发器）
  - UART为标准的串行通信接口，字符格式按照低位在前、高位在后的次序进行传输，1位起始位，5\~8位数据位，1位奇偶校验位，1\~2位停止位
- **I<sup>2</sup>C**（Inter-Integrated Circuit）
  - I<sup>2</sup>C是集成电路互连的一种总线标准，只有两根信号线，一根是时钟线SCL，一根是数据线SDA（双向三态），**即可完成数据的传输操作**
  - 具有特定的起始位和终止位，可完成同步半双工串行通信方式，常用于*板级芯片之间的短距离低速通信*
- **I<sup>2</sup>S**（Inter-Integrated Circuit Sound Bus）
  - I<sup>2</sup>S是一种面向多媒体应用的音频串行总线，是SONY、PHILIPS等公司共同推出的接口标准，主要针对数字音频设备如便携CD机、数字音频处瑾器等，专用于这些*音频设备之间的数据传输*。
- **SPI**（Serial Peripheral Interface）
  - SPI是串行外设接口，总线系统是一种同步串行外设接口，可以使MCU与各种外围设备以串行方式进行通信
  - 通常用四线制，包括**MISO**(主输入从输出)、**MOSI**(主输出从输入)、**SSL**(芯片选择)、**SCK**(时钟)
  - 可完成全双工的同步串行通信，用于*板级芯片之间的短距离通信* 
- **CAN**（Controller Area Network）
  - CAN是控制器局域网，仅有CANH和CANL两根信号线，采用差分传输的方式，可以进行远距离（1200m）多机通信。主要用于*要求抗干扰能力强的工业控制领域* ，可组成多主多从系统
- **USB**（Universal Serial Bus）
  - USB是一种通用串行总线，主要应用于*与外部设备的短距离通信*，采用差分方式传输数据，速度快，效率高，是目前**应用最广**的串行总线接口形式。
- **Ethernet**
  - Ethernet是以太网通信接口，在许多新型ARM芯片（如Cortex-M3系列）中均集成了这一接口，使连接以太网变得非常容易，外部仅需要连接一个RJ-45连接器即可。

### 考点5 常用ARM嵌入式处理芯片

#### 1、NXP的典型ARM芯片（荷兰恩智浦半导体公司）
- **基于ARM7TDMI-S核的LPC2000系列**
- 基于ARM7TDMI-S核的LH7系列
- 基于ARM9的LPC2900以及LPC3000系列
- 基于ARM922T的LH7A系列
- 基于Cortex-M0的LPC1000系列
- 基于Cortex-M3的LPC1300/LPC1700/LPC1800系列
  - 以第二代Cortex-M3为内核，主频高达100MHz，带独立的本地指令和数据总线以及用于外设的第三条总线，运行速度高达1.25MIPS/MHz,特别适用于静电设计、照明设备、工业网络、报警系统、白色家电、电机控制等领域
- 基于Cortex-M4+M0双核的LPC4000系列
  - 基于Cortex-M4内核的DSP完美融合了微控制器M0的基本功能和M4的高性能数字信号处理功能

#### 2、TI的典型ARM芯片（美国德州仪器公司）
- **主要特色是全部内置10位ADC**
- 基于ARM9的ARM芯片
- 基于ARM Cortex-M3的低成本低功耗LM3SX00系列
- 基于ARM Cortex-M3的高性能LM3S1000系列
- 基于ARM Cortex-M3带CAN控制器的LM3S2000系列
- 基于ARM Cortex-M3带USB接口的LM3S3000系列
- 基于ARM Cortex-M3带USB+CAN接口的LM3S5000系列
- 基于ARM Cortex-M3带Ethernet接口的LM3S6000系列
- 基于ARM Cortex-M3带Ethernet+CAN接口的LM3S8000系列
- 基于ARM Cortex-M3带Ethernet+USB+CAN接口的LM3S9000系列
- 基于ARM Cortex-M3带Cortex-M4的LM4F系列
  - 内置FPU浮点运算部件
- 基于ARM Cortex-R的TMS570LS2x等
- 基于ARM Cortex-M4F的LM4F系列
- 基于高端应用的Cortex-A8的AM35X/AM37X/AM38X
- 基于C674+ARM Cortex-A8的TMS320C6A8167和TMS320C6A8168
- 基于ARM Cortex-A的0MAP4系列
- 基于ARM Cortex-A15的0MPA5系列
  - 主要用于智能手机及移动计算

#### 3、Samsung的典型ARM芯片（韩国三星公司）
- **最早得到应用**的ARM处理器芯片厂商
- **基于ARM7TDMI内核的S3C44B0**
  - 专为手持设备使用
- 基于ARM920T内核的S3C24xx系列
- 基于ARM11的S3C6xxx系列
- 基于ARM Cortex-A8的S5PC100系列
- 基于ARM Cortex-A9的Exynos4系列
- 基于ARM Cortex-A15的Exynos5系列

#### 4、Atmel的典型ARM芯片（美国艾特美尔公司）
- 基于ARM7TDMI内核的SAM7X系列
- 基于ARM926EJ-S的SAM9X系列
- 基于ARM Cortex-M3的SAM3X系列
- 基于ARM Cortex-M4的SAM4X系列

#### 5、ST的典型ARM芯片（法国意法半导体公司）
- 基于ARM7TDMI内核的STR7系列
- 基于ARM9E内核的STR9系列
- 基于ARM Cortex-M0的STM32F0系列
  - 有12位的ADC和DAC，带比较器
- 基于ARM Cortex-M3的主流ARM芯片STM32F1系列
- 基于ARM Cortex-M3的低功耗ARM芯片STM32L1系列
- 基于ARM Cortex-M3的高性能ARM芯片STM32F2系列
- 基于ARM Cortex-M4的高性能ARM芯片STM32F4系列

#### 6、Freescale的典型ARM芯片（美国飞思卡尔公司）
- 基于ARM Cortex-M0的Kinetis L系列
- 基于ARM Cortex-M4的Kinetis K系列
  - **有超过200种不同结构的低功耗、高性能、可兼容的微控制器**
- 基于ARM Cortex-M4的Kinetis X系列
  - 速度最快的微控制器

#### 7、Nuvoton的典型ARM芯片（台湾新唐科技公司）
- NUC100系列
- 带USB全速2.0设备的低功耗NUC120/NUC122系列
- 内嵌CAN控制器局域网2.0B标准的NUC130/140系列
- 继M051系列之后的低管脚、低价位的Mini51系列
- 以200uA/MHz常态低功耗运行的Nano100超低功耗系列
  - 应用领域相当广泛，包括**触控屏幕、USB连接、直流无刷电机、汽车电子、医疗电子**等。此前还有ARM7和ARM9产品

#### 8、Intel的典型ARM芯片（美国英特尔公司）
- XScale核的PXA250和PXA270

#### 9、其他ARM芯片厂家
- 美国益登科技基于ARM Cortex-M3处理器的新型Precision32系列产品，包括SIM3UIxx和SIM3CIxx系列
- 其他生产ARM芯片的国外厂家还有Alilent、Cirrus、Hynix、Linkup、Motorola、NEC、IVetSilion、OKI、Parthus、Qualcomm、Rohm、Triscend等，国内也有购买ARM内核的科研院所和生产厂家

### 考点6 嵌入式系统芯片的选型

##### 嵌入式系统芯片的选型应该遵循的原则
1. **性价比原则**
   1. 性能：应该选择完全嫩满足要求且略有余量的嵌入式处理芯片，够用就行
   2. 价格：在满足需求的前提下选择价格便宜的
2. **参数选择原则**
   1. ARM内核
   2. 系统时钟频率
   3. 芯片内部存储器的容量
   4. 片内外围电路
      - GPIO外部引脚条数
      - 定时计数器
      - LCD液晶显示控制器
      - 多核处理器
      - ADC
      - 通信接口
   5. 其他因素

### 考点7 存储器层次结构
- 对于CPU使用最频繁的少量程序代码和数据用**SRAM**作为Cache存放
- 正在运行中的程序的大部分数据和代码存放在**主存**中
- 尚未启动运行的其余程序或数据则存放在容量大的外部存储器如磁盘（**虚拟内存**）中待命

##### 存储器三个层次结构（除内核寄存器外）
- ![image-20210320104215426](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210320104215426.png)
- 最上层是处理器内部的通用寄存器，是速度最快的一层
- 其次就是处理器内部的Cache，其下就是主存储器
  - 使用Cache的优点是只需要**增加少许成本**，整个系统的性能就能得到**显著提高**，目前嵌入式系统采用SARM作为Cache
- 最后一层是容量很大、速度最慢的外部存储器

### 考点8 存储器分类

##### 嵌入式系统使用的存储器分类
- 按照其**存取特性**分
  - 随机存取存储器（RAM）
  - 只读存储器（ROM）
- 按照**存储信息的不同**分
  - 程序存储器
  - 数据存储器
- 按照**所处物理位置**分
  - 片内存储器（芯片内置的存储器）
  - 片外存储器（外部扩展的存储器）
  - 外部存储设备
- 嵌入式系统中把片内存储器及片外存储器简称为**主存储器或主存**；把外部存储设备简称为**辅助存储器**

##### 嵌入式系统主存种类
1. 半导体存储器
   1. RAM
      - **SRAM**-静态随机存取存储器
      - **DRAM**-动态随机存取存储器
   2. ROM
      - **MROM**-掩膜型只读存储器
      - **PROM**-一次可编程只读存储器
      - **EPROM**-紫外线可擦除可编程只读存储器
      - **E<sup>2</sup>PROM**-电可擦除可编程只读存储器
      - **Flash ROM**-闪速存储器（NOR与NAND两类）
2. 新型存储器
   - **FRAM**-铁电随机存取存储器
   - **MRAM**-磁性随机存取存储器

#### 1、RAM
- 有两种形式，分别为静态和动态，均为**易失性存储器**，现在多数嵌入式处理器内嵌的数据存储器都采用SRAM，而外部扩展的存储器多采用DRAM及其改进型
- DRAM开发的新品种主要如下：
  - DDR SDRAM，
    - 新的内存标准之一，双边沿触发传送数据，把数据传输速率提高了一倍
    - 可预读取2位数据
  - DDR2
    - 把DDR的数据传输速率提高了两倍
    - 可预读取4位数据
  - DDR3
    - 把DDR2的数据传输速率提高了两倍
    - 可预读取8位数据
  - DDR4
    - 把DDR3的数据传输速率提高了两倍
    - 一种使用Single-ended Signaling信号，其传输速率为1.6\~3.2GB/s
    - 另一种基于差分信号技术，其传输速率将可以达到**6.4GB/s**

#### 2、ROM
- MROM
  - MROM是基于掩膜工艺技术的只读存储器，主要用于**不可升级的成熟产品存储程序**或**不变的参数**等信息
- PROM
  - PROM是一次可编程只读存储器，**只能一次编程，一旦编程完毕则无法修改**
- EPROM
  - EPROM是紫外线可擦除可编程只读存储器，擦除编程次数**十万次**以内，**编程速度慢**，**擦除时间长**
- E<sup>2</sup>PROM
  - E<sup>2</sup>PROM是电可擦除可编程只读存储器，可以在线改写和擦除信息，无需紫外线照射
- Flash ROM
  - 特点是擦除和编程速度快，得名闪速存储器，简称**闪存**
- NOR Flash ROM
  - NOR Flash颠覆了原先由EPROM和E<sup>2</sup>PROM一统天下的局面
  - NOR Flash ROM是**以字节为单位随机存取**。这样，应用程序可以直接在Flash ROM中执行，不必再把程序代码预先读入到RAM中
  - 与NAND Flash ROM相比，NOR Flash ROM的接口简单，可以直接连接到处理器的外围总线上（而NAND Flash ROM必须配置专用的NAND Flash ROM控制器或采用通常的I/O接口才能使用）。但是NOR Flash ROM**写入和擦除速度较慢**，影响了它的性能。
- NAND Flash ROM
  - NAND Flash结构，单元电路尺寸几乎只是NOR器件的一半
  - NAND Flash ROM**以页（行）为单位随机存取**
  - 对比NOR Flash ROM，NAND Flash在容量、使用寿命和成本方面有较大优势。但是它的**读出速度稍慢，编程较为复杂**，因此**大多作为数据存储器**使用。
  - 嵌入式产品中包括数码相机、MP3随身听记忆卡、体积小巧的U盘等均采用NAND Flash ROM

#### 3、FRAM
- FRAM的铁电晶体的稳定性极高，它就既具有只读存储器**非易失性**的特点，又具有随机存储器可快速随机读写的特点，而且速度快、功耗低，
- 目前不仅被应用到嵌入式微处理器内部以取代SRAM和Flash存储器，而且在其他嵌入式应用领域的应用越来越广泛

#### 4、MRAM
- MRAM是一种**非易失性**（或非挥发性）的磁性随机存储器，具有SRAM的高速存取能力以及DRAM的高集成度，而且基本上可以**无限次地重复写入**

### 考点9 存储器主要性能指标

#### 1、容量
- 存储器容量是指每一个存储芯片或模块能够存储的**二进制位数**。
- 存储器容量以存储1位二进制位为最小单位(b)，容量单位有字节(B)、千字节(KB)、兆字节(MB)、吉字节(GB)、太字节(TB)、拍字节(PB)、艾字节(EB)、泽字节(ZB)、尧字节(YB)
- 对于内存容量来说，这些容量单位之间的相互关系均以2<sup>10</sup>倍表示
- 对于外存容量来说，这些容量单位之间的相互关系均以10<sup>3</sup>倍表示
- 内存储器有多大容量取决于存储单元的个数和存储器各单元的位数。
  - **内存容量=单元总数 x 数据位数 / 单元**
- 单元个数与存储器的地址线有密切关系，因此存储芯片的容量完全取决于存储器芯片的地址线条数和数据线的位数。
  - 假设单元个数为L，数据线位（条）数用N表示，地址线条数用M表示，容量用V表示
  - **V=L x N=2<sup>M</sup> x N**

#### 2、存取时间
- 存取时间是从CPU给出有效的存储器地址开始到存储器读出数据（或者是把数据写入存储器）所需要的时间
- 存储器芯片的工作速度通常用存取时间来衡量。由于现在的存储器都较快，内存的存取时间通常以**ns**为单位

#### 3、宽度
- 存储器的带宽指每秒可传输（读出/写入）的最大数据总量，存储器带宽与存储器总线频率有关，也与数据位数（宽度）和每个总线周期的传输次数有关。
- 并行总线的存储器带宽
  - **带宽=总线频率 x 数据宽度 / 8 x 传输次数 / 总线周期 （B/s）**
- 串行总线的存储器带宽
  - 串行总线按位顺序传输，其带宽的计算公式如下，通常串行总线以10位为一个数据帧（含一字节数据）
  - **带宽=总线频率 x 1 / 10 （B/s）**

### 考点10 片内存储器

#### 1、片内Cache
- 嵌入式微处理器内部集成了几KB到几百KB，有的达到几MB的Cache，有的嵌入式微处理器内部有片内一级Cache，还有二级Cache
- 借助内部Cache，系统**减少了访问外部存储器的次数**，**提高了系统运行效率**，在性能高的嵌入式处理器中都会集成内部Cache

#### 2、片内Flash ROM
- 大部分嵌入式微控制器内部集成有一定容量的Flash ROM作为程序存储器，从几KB到几MB不等
- 有了内置Flash，嵌入式系统就可以**以最小系统形式**（无需外接程序存储器）应用到各个领域，充分体现了嵌入式系统的专用性和嵌入性

#### 3、片内Flash SRAM
- 嵌入式微处理器内部集成了几KB到几MB不等的SRAM作为数据存储器，用来临时存放系统运行过程中的数据、 变量、中间结果等
- 由于SRAM是易失性存储器，因此系统复位后要对SRAM**进行初始化操作**

#### 4、片内E<sup>2</sup>PROM
- 相当一部分嵌入式微控制器内部还配置了几KB到几MB不等的E<sup>2</sup>PROM作为长期保存重要数据的存储器
- 因为是非易失性存储器，掉电后信息保持不变，因此**常用于存放系统的设置和配置信息以及希望长期保存且很少改写的一些数据**

#### 5、片内FRAM
- 目前已有部分嵌入式微控制器内部集成了FRAM，由于它具有RAM和ROM的全部特点，因此既可当作RAM用，又可当做ROM用，是当前嵌入式微控制器内部的主要存储器之一

### 考点11 片外存储器

#### 1、片外程序存储器
- **NOR Flash ROM**
  - 主要有Intel的E28F系列、AMD的AM29系列、SST的SST39系列、SPANSION的S29系列
- **NAND Flash ROM**
  - 主要有三星的K9系列、现代的HY27系列、ST的NAND系列、东芝的TC58系列

#### 2、片外数据存储器
- 嵌入式系统使用的外部数据存储器有SDRAM、DDR系列等。早期的ARM芯片仅支持SDRAM ，新型的ARM芯片如Cortex-A系列还支持DDR系列存储器
- 现代公司生产的DDR存储器命名规则为<code>HYXZmnjk</code>
  - HY为**现代标识**
  - X为**存储器类型**
    - 5和57表示SDRAM，5D表示DDR
  - Z为**电压级别**
    - U表示2.5V，V表示3.3V，空白表示5V
  - m表示**总容量**
    - 对于SDRAM，64和65表示64MB，26和28表示128MB，56和52表示256MB
    - 对于DDR，28表示128MB，56表示256MB，12表示512MB
  - n表示**数据宽度**
    - 16表示16位位宽，32表示32位位宽
  - j表示**逻辑BANK数**
    - 1表示2个BANK，2表示4个BANK，3表示8个BANK，实际上是选择BANK的输入引脚个数
  - k表示**电气接口**
    - 0表示LVTLL，1表示SSTL，2表示SSTL_2

### 考点12 外部辅助设备
- 常见类型的闪存卡
  - **SD卡**、**CF卡**、SM卡、XD卡、MMC、记忆棒
- U盘
  - 全称USB闪存盘，英文名为USB Flash disk。是一种**使用USB接口的无需物理驱动**的移动存储产品，通过USB接口与系统连接，**实现即插即用**
- 微硬盘
  - 最早由IBM公司开发，其最初的容量为340MB和512MB，现在有1GB、16GB、60GB、240GB等等
  - 特点
    - 超大容量
    - 使用寿命长
    - 带有缓存
    - 无需外置电源
    - 高速传输
    - 接口多样，兼容性好
    - 高防振性

### 考点13 通用I/O接口GPIO
- 所有嵌入式处理器内部均集成了GPIO接口，GPIO接口提供的**输入具有缓冲功能**，**输出具有锁存功能**
- 有的嵌入式处理器芯片通过**设置端口的方向**来确定是输人功能还是输出功能，也有的嵌入式处理器直接根据**读写命令自动控制**输入或输出的方向。GPIO一般具有三态，即**0态、1态和高阻态**
- 有些GPIO有多种功能以供选择，有**两功能的、三功能的、四功能**的，可以通过**设置相关控制寄存器的位**来确定引脚功能。有些ARM芯片，如新唐科技的Cortex-M0芯片每个引脚都可以**设置成中断输入**
- 典型的1位GPIO输入/输出接口
  - ![image-20210320151734160](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210320151734160.png)

### 考点14 集成电脑互联总线接口I<sup>2</sup>C

#### 1、I<sup>2</sup>C的概述
- 集成电路互连（Inter IC，I<sup>2</sup>C）总线用于连接嵌入式处理器及其外围器件，它是广泛采用的一种**串行半双工**传输的总线标准，可以方便地用来将微控制器和外围器件连接起来构成一个系统
- 主动发起数据传输操作的I<sup>2</sup>C器件是**主控器件**，否则它就是**从器件**
- I<sup>2</sup>C总线具有**接口线少**，**控制方式简单**，**器件封装紧凑**，**通信速率较高**（100kb/s，400kb/s，高速模式可达3.4MB/s）等优点

#### 2、I<sup>2</sup>C总线的操作时序
- I<sup>2</sup>C总线只有两条信号线，一条是数据线SDA，另一条线是时钟线SCL，所有的操作都通过这两条信号线完成。
- SDA上的数据必须在时钟的高电平周期保持稳定，它的高低电平状态只有在SCL是低电平时才能改变

##### I<sup>2</sup>C总线数据传输时序
- ![image-20210320152629259](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210320152629259.png)
- **启动和停止条件**
  - 总线上的所有器件都不使用总线时（**总线空闲**），**SCL线和SDA线**各自的上拉电阻把**电平拉高** ，使它们均处于高电平
- **数据传送格式**
  - 数据传送时高位在前，低位在后，每次传送的**字节数目没有限制**。传输操作启动后主控器件传输的**第一字节是地址**
- **应答ACK信号传送**
  - 为了完成一字节的传送，接收方应该发送一个确认信号ACK给发送方。ACK信号出现在SCL的**第9个时钟脉冲**上，有效应答ACK在SDA上呈现低电平
- **读/写操作**
  - 在发送模式下，数据被发送出去后，I<sup>2</sup>C接口将处于等待状态（SCL线将保持低电平），直到有新的数据写入I<sup>2</sup>C数据发送寄存器之后，SCL线才被释放，继续发送数据
  - 在接收模式下，I<sup>2</sup>C接口接收到数据后，将处于等待状态，直到数据接收寄存器内容被读取后，SCL线才被释放，继续发送数据
- **总线仲裁**
  - I<sup>2</sup>C总线属于**多主总线**，即允许总线上有一个或多个主控器件和若干从器件同时进行操作
  - 总线上连接的这些器件有时会同时竞争总线的控制权，这就需要进行仲裁。I<sup>2</sup>C总线主控权的仲裁有一套规约。
- **异常中断条件**
  - 如果没有一个从器件对主控器件发出的地址进行确认，那么SDA线将保持为高电平
  - 如果主控器件涉入异常中断，在从器件接收到最后一个数据字节后，主器件将通过**取消一个ACK信号的产生**来通知从器件传送操作结束

#### 3、I<sup>2</sup>C总线接口的连接
- ARM芯片内部集成了I<sup>2</sup>C总线接口，因此可直接将基于I<sup>2</sup>C总线的主控器件或被控器件挂接到I<sup>2</sup>C总线上。每个器件的I<sup>2</sup>C总线信号SCL和SDA与**其他具有I<sup>2</sup>C总线的处理器**或**设备同名端**相连，在SCL和SDA线上要接上拉电阻
- 在ARM芯片中内置了I<sup>2</sup>C总线控制器，I<sup>2</sup>C总线在主器件和从器件之间进行数据传输之前，必须根据要求设置相应的I<sup>2</sup>C的有关功能寄存器，包括I<sup>2</sup>C总线控制寄存器、I<sup>2</sup>C总线状态寄存器、I<sup>2</sup>C总线地址寄存器、I<sup>2</sup>C总线接收/发送数据移位寄存器

### 考点15 串行外设接口SPI

#### 1、SPI简介
- SPI是一种**同步串行外设接口**，允许嵌入式处理器与各种外围设备以串行方式进行通信、数据交换。
- 基于SPI接口的外围设备主要包括Flash ROM、RAM、A/D转换器、网络控制器、MCU等
- SPI系统可直接与各个厂家生产的多种标准外围器件直接相连，一般使用4条线：
  - 串行时钟线**SCK**、主机输入/从机输出数据线**MISO**、主机输出/从机输入数据线**MOSI**、低电平有效的从机选择线**SSEL**
  - 有的SPI接口芯片带有中断信号线INT，有的SPI接口芯片没有MOSI

#### 2、SPI的操作过程
- 将数据写到SPI发送缓冲区后，在时钟信号SCK作用下，**一位一位按位传输**
- 在主机中数据从移位寄存器中自左向右发出送到从机(MOSI)，同时从机中的数据自右向左发到主机(MISO)，**经过8个时钟周期完成1字节的发送**
- 输入字节保留在移位寄存器中，然后从接收缓冲区中读出1字节的数据。
- ![image-20210320154842123](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210320154842123.png)

#### 3、SPI接口的连接
- 一主一从式系统
  - 接收和发送数据是**单向**的。主机SCK作为同步时钟输出到从机，主机SSEL接高电平，从机SSEL接低电平
  - ![image-20210320160336929](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210320160336929.png)
- 互为主从式系统
  - MISO和MOSI以及SCK都是**双向**的，视发送或接收而定，SSEL电平不能固定，如果作为主机，则设置SSEL位低电平，迫使对方作为从机
  - ![image-20210320160535377](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210320160535377.png)
- 一主多从式系统
  - 大部分应用场合使用比较多的是一主多从式SP结构，SPI的所有信号都是**单向**的，主机MOSI和SCK都为输出，MISO位输入，主机SSEL接高电平，作为主机使用。由于系统中有多个从机，因此使用主机的I/O引脚去选择要访问的从机，即GPIO的某些引脚连接从机的SSEL端
  - ![image-20210320160801232](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210320160801232.png)
- 多主多从式系统
  - 对于多主多从的SPI系统，MISO、MOSI及SCK视何时作为主机使用而定，主要考虑的是**SSEL选择信号的接法**，即每个主/从机的SSEL被其他主/从机选择，其他主/从机的GPIO引脚都参与主/从机的选择。这是最复杂的情况，实际应用系统中，尤其是嵌人式系统用得不多。 
  - ![image-20210320161016487](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210320161016487.png)

### 考点16 串行异步通信接口UART

##### UART概述
- 串行异步通信接口通用异步收发器(UART)，常用于**全双工串行异步**通信
- 所有嵌入式处理芯片内部均集成了兼容标准UART功能的组件，有的**集成了多个UART**
- UART由发送器、接收器、控制单元、波特率发生器等构成。

##### UART组成
- ![image-20210323215754460](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210323215754460.png)
- **发送器**
  - 负责字符的发送，可采用先进先出(FIFO)模式，也可采用普通模式发送
  - 发送的字符先送到发送缓冲寄存器，然后通过移位寄存器，在控制单元的作用下，通过TXDn引脚一位一位顺序发送出去
- **接收器**
  - 接收器负责外部送来字符的接收，可以是**FIFO模式接收** ，也可以是**普通模式接收**
  - 在FIFO模式下，只有缓冲器满才引发接收中断并置位接收标志
  - 在普通模式下，接收到一个字符就引发接收中断并置标志位
- *说明*：
  - 一般接受和发送缓冲器的FIFO字节数N是一样大小的，均可编程选择长度，**不同ARM芯片，FIFO缓冲器最大字节数N不同**
  - ARM9的S3C2410和Cortex-M3的LPC1766为16B，**ARM9的S3C2440为16B**
- **波特率发生器**
  - 波特率发生器在外部时钟的作用下，通过编程可产生所需要的波特率，**最高波特率为115200b/s**
  - 波特率的大小由波特率系数寄存器如UBRDIVn决定

##### 字符格式的约定
- UART的信息传送按位进行，因此有一定的字符格式的约定
- ![image-20210323221216489](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210323221216489.png)
- 字符总是以**起始位为开始**，以**停止位为结束**，并且数据以低位在前、高位在后按次序传输
- 数据位可为**5位、6位、7位和8位**，**由编程决定**
- 数据位之后是校验位，可为奇校验或偶校验，也可以没有校验
- **起始位以逻辑0**为标志，**停止位以逻辑1**为标志，停止位可为1位、1.5位和2位
- 字符格式由线路控制寄存器如ULCONn决定
- *说明*：
  - 通常情况下**接收采用中断**方式，**发送采用查询**方式。这是因为发送由程序直接控制，而接收时对方的信息是随机的。
  - 直接用UART进行通信仅限于板间或芯片间通信，如果**超过1m**的距离或**环境比较恶劣**，则需外接逻辑电平转换接口，如**RS-232、RS-422、RS-485** 

### 考点17 通用串行总线USB

#### 1、USB的简单介绍
- **通用串行总线**(USB)是一种外部总线接口标准，用于规范系统与外部设备的连接和通信，是嵌入式应用领域最常用的总线接口之一
- USB总线接口支持的设备的**即插即用**和**热插拔功能**
- USB总线通信采用**主从方式**
- USB OTG的作用是**可以摆脱主机**，直接在具有OTG的USB总线上完场点对点通信，实现在没有主机的情况下设备之间可以进行数据传送

#### 2、USB的主要特点
- **使用方便**
  - 一个端口可以连接多个不同的设备，支持**热拔插**
- **速度快**
  - 目前USB2.0的速度为480Mb/s，USB3.0达到5Gb/s即640MB/s。*注意单位，USB2.0是Mb/s，USB3.0是MB/s*
- **连接灵活**
  - 即可以使用**串行连接**，也可以**使用USB Hub**把多个USB设备连接在一起，USB能智能识别USB链上外围设备的接入或拆卸
- **独立供电**
  - USB接口提供**内置电源**，USB电源能向低压设备提供5V的电源，提供500mA电流(USB3.0能提供900mA)

#### 3、USB硬软件构成
- USB系统由**USB硬件**和**USB软件**组成
- USB硬件中的USB主控制器包括一个Root Hub，它提供一个或多个USB下行端口，每个端口可以连接一USB Hub或一个USB设备，使一个USB端口扩展为多个端口，最多可支持127个外部设备
- USB软件主要是相关的驱动程序，包括USB设备驱动程序、USB驱动程序以及USB主控制器驱动程序

#### 4、USB的信号编码方式
- USB采用翻转不归零制（NRZI）编码方式对数据进行编码
- NRZI的编码中，电平**保持时传送逻辑1**，电平**翻转时传送逻辑0**

#### 5、USB总线的接口信号
- USB总线（**1.1和2.0**）有**4根信号线**，采用**半双工差分方式**，用来传送信号并提供电源
- 其中，D+和D-为差分信号线，传送信号，它们是一对双绞线；另两根是电源线和地线，提供电源

### 考点18 高清多媒体接口HDMI

#### 1、HDMI概念
- 高清晰度多媒体接口(HDMI)是一种数字化音频/视频接口，适合影像传输，可同时传送音频和视频信号而无需在信号传送前进行数/模或者模/数转换，**最高数据传输速度为10.2Gb/s**
- HDMI在嵌入式视频监控系统中应用广泛，目前已有多个ARM芯片内置了HDMI控制器接口

#### 2、HDMI介绍
- HDMI有两种连接器接口形式，一种是**19针**（Type A），另一种29针（Type B）
  - 29针支持双通道连接，目前还没有厂商使用
- HDMI有1.0、1.1、1.2、1.3、1.4几个版本，1.0~1.2最高传输率为**5Gb/s**，1.3版本以后达**10.2Gb/s**。目前支持1.2版本的设备和接口比较普遍。1.4a加入了用于广播系统中的强制3D画面传输格式标准
- HDMI的设备具有**即插即用**的特点，与DVI相比HDMI接口的体积更小

### 考点19 常用简单输入设备

#### 1、键盘
- 通常可应用GPIO引脚构建简单键盘，分为**线性键盘和矩阵键盘**
- 线性键盘是指一个按键占用一个引脚，利用读该引脚的状态确定按键的状态
  - ![image-20210324215544576](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210324215544576.png)
  - 当无键按下，因R7接到电源端，因此引脚GPF1为高电平（逻辑1）
  - 当KEY1按下时，由于KEY1一端接R1，另一端接地，经过R1、R7分压，GPF1引脚的电压为0.1KΩ / 10KΩ x 3.3V = 0.033V，为低电平（逻辑0）。因此程序只要读取GPF1引脚的状态就可以知道KEY1是否被按下
  - S3C2410和S3C2440的GPF1\~GPF6正好是EINT1\~EINT6这个六个外部中断引脚，因此除了通过**查询方式**读按键之外，还可通过**中断读取按键结果**
- 矩阵键盘采用行列矩阵形式构成键盘，利用行扫描法或反转法读取按键的特征值来决定按键的结果
  - ![image-20210324220439156](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210324220439156.png)
  - 行列矩阵式键盘设计法，即**行扫描法**
  - 行扫描方法的键盘电路设计如图所示，采用四根I/O引脚GPG4\~GPG7作为行扫描输出，四根I/O引脚GPF0\~GPF3作为输入检测，同时这四个输入引脚接一四输人与门，与门输出接外部中断2即EXINT2引脚
  - 这样可以**采用中断方式**，读取键盘值（0\~F），在中断服务程序中判断GPF0\~GPF3**哪个引脚为低电平**，然后结合输出扫描的行号即可合成对应的键值

#### 2、触摸屏
- 目前的触摸屏有两种形式，一种是电阻式触摸屏（俗称软屏），另一种是电容式触摸屏（俗称硬屏）
- **电阻式触摸屏**
  - 结构简单，价格低，用专用硬笔写字的触摸屏属于电阻式
  - 是一种电阻传感器，它将矩形区域中触摸点(x,y)的物理位置转换为代表x坐标和y坐标的电压
- **电容式触摸屏**
  - 结构复杂，价格高，带多点触摸或滑动操作的触摸屏均属于电容式。电容式触摸屏的应用越来越广泛
  - 当触摸屏幕时，由于人体电场，手指与导体层间会形成一个**耦合电容**，四边电极发出的电流会流向触点
  - 一般电容式触摸屏与ARM处理芯片采用**USB或I<sup>2</sup>C总线方式**连接

### 考点20 常用简单输出设备

#### 1、LED发光二极管
- LED发光二极管与ARM芯片的连接仅需要一根GPIO引脚，但**绝对不能直接把引脚连接到发光二极管上**，因为通常ARM芯片GPIO引脚提供的电流是有限的，不能直接驱动发光设备，因此**要加驱动电路**
- ![image-20210324221713861](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210324221713861.png)

#### 2、LED数码管
- LED数码管如下图所示，有八个段，a、b、c、d、e、f、g、dp。
- 数码管有**共阳和共阴**两种接法，共阳即把LED发光管的所有阳极连接在一起。共阴就是把所有LED发光管的阴极连接在一起
- ![image-20210324221906745](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210324221906745.png)

##### S3C2410与一位数码管的连接示意图
- ![image-20210324222148147](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210324222148147.png)
- 假设八段数码管为共阳接法。U1作为正向驱动且具有锁存功能。例如，要显示9则通过数据总线向锁存器U1送出的代码为0x90，选中的地址为nGCS2。*共阳接法，低电平亮，共阴接法，高电平亮*
- 图中74HC573在CLK上升沿时把数据打入锁存器，而系统在选中nGCS2时正好产生一个负脉冲，在上升沿时数据巳 经稳定在数据总线上，因此满足时序要求
- 在S3C2410以及S3C2440中，nGCS2的地址范围为**0x10000000\~0x18000000**，只要用这段地址中的仟何一个送数据均可点亮本LED数码管

#### 3、LCD显示设备

##### LCD显示设备按其完整程度的分类
- **LCD显示屏**
  - LCD显示屏**自身不带控制器，没有驱动电路**，仅仅是显示器件（屏）价格最低
  - 这类显示模块有字符型，有图形点阵型，还有带汉字库的图形点阵型等
- **LCD显示模块（LCM）**
  - 嵌入式系统中使用比较多的是LCD显示屏和LCD显示模块，通过GPIO以并行方式连接LCD显示模块或通过串行方式
- **LCD显示器**
  - PC机通常使用的是LCD显示器，除了具备显示屏外还包括驱动器、控制器以及外壳，是最完备的LCD显示设备，其接口也有相应的标准，主要包括VGA、DVI两种形式，现在又开始流行HDMI接口
  - 通用计算机使用的LCD显示器，包括显示屏，驱动电路，接口，电源和外壳，是完整的显示设备

### 考点21 S3C2410,S3C2440芯片的内部结构

#### 1、S3C2410,S3C2440芯片的内部结构介绍
- S3C2410采用ARM920T核；而ARM920T又集成了ARM9TDMI，属于中高档**32位嵌入式处理器**
- 采用ARM920T体系结构，因此内部具有分离的16KB大小的指令Cache和16KB大小的数据Cache
- 采用**哈佛体系结构**，程序存储器与数据存储器分开，分别有各自的存储管理部件MMU
- 采用**五级流水线**，使用ARM公司特有的AMBA总线，对于**高速组件**采用AHB总线，而对于**低速外设**接口则采用APB总线
- 芯片内部集成了许多硬件组件，包括连接到系统总线AHB上的系统总线控制器、电源管理器单元、PPL（锁相环）时钟发生器、内部SRAM、**外部存储控制器（外部主控器）**、LCD控制器、DMA控制器、中断控制器；S3C2410,S3C2440的SDI/MMC组件用于驱动SD存储卡和MMC存储卡
- S3C2440在S3C2410的基础上增加了**视频与音频接口**，如增加了连接对AHB总线上的摄像机接口和APB总线上的AC97音频接口

#### 2、S3C2410的存储器控制组件的简单介绍
- S3C2410存储器控制组件包括存储器控制器、总线控制器、外部主控器、NAND Flash控制器等
- 存储器控制器地址空间共**1GB**。（8个BANK，每个BANK大小为128MB）
- 以ARM芯片为核心的嵌入式系统其I/O余存储器采用**统一编制**方式
- **BANK0只能是16位和32位**总线宽度的访问，其他所有BANK可访问**8位、16位、32位**

### 考点22 S3C2410的时钟及电源管理组件
- S3C2410内部有时钟振荡电路，经过主锁相环电路得到更加固定的锁相后的时钟，在时钟控制器、电源控制器以及USB控制器的控制之下，产生不同需求的时钟信号如MPLL时钟（锁相环时钟）、UPLL时钟（USB时钟）、HCLK时钟（连接到AHB总线上外围高速组件使用的时钟）、PCLK时钟（连接到APB总线上外围组件使用的时钟）、FCLK时钟（内核所需快速时钟）等供不同组件使用
- MPLL输入时钟可由引脚OM[3:2]选择采用**外部时钟EXTCLK**还是**外接晶体**利用内部振荡电路输出的时钟

##### 电源管理工作模式及其转换
- ![image-20210325112841531](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210325112841531.png)

电源管理模块分类
- **正常模式**
  - 电源管理模式为内核及ARM芯片内部所有硬件组件提供时钟源，用户可以通过软件控制内置硬件组件的开启和关闭，**暂时不用的硬件可以关闭以降低功耗**
- **慢速模式**
  - 不使用PLL时钟（ MPLL关闭不使用），这样功耗降低，仅使用外部晶体或外部时钟直接提供给其他组件使用，不通过锁相环电路
- **休眠模式**
  - 电源管理模块仅断开ARM内核时钟FCLK，让CPU处于休眠状态，但仍为外围硬件组件提供时钟
- **掉电模式**
  - 电源管理模块将断开内部电源，除非唤醒逻辑有效，否则内核不产生功耗
- *说明*：
  - 任何情况下**复位操作均自动进入正常工作模式**
  - 在掉电模式和休眠模式下，只要有任何一个外部中断ENIT[0:23]或RTC时钟中断发生，均将返回到正常模式

### 考点23 S3C2410 的中断控制器及中断控制

##### S3C2410 的中断控制概述
- 以ARM为内核的处理器其异常共分为**7种**，每一种异常对应一个异常向量，每个异常向量占**4个字节**，指出中断服务程序的入口地址
- 异常向量表从0x00000000\~0x0000001F。其中**普通中断IRQ**和**快速中断FIQ**的向量地址为0x00000018\~0x0000001B和0x0000001C\~0x0000001F
- 每一个ARM 芯片，除了**内核异常**外，还有多种**内置硬件组件的中断**，这些中断源的中断向量对应于IRQ 或IFQ，可通过**设置模式寄存器**来确定
- ![image-20210325114637827](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210325114637827.png)

##### S3C2410 的中断控制器相关寄存器功能及地址分配表
- ![image-20210325114735331](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210325114735331.png)
- 源中断挂起寄存器SRCPND和中断挂起寄存器INTPND，它们指示某个中断请求是否处于挂起状态
- 当多个中断源请求服务时，SRCPND相应的位写入1，通过**优先级仲裁**当前最高优先权的中断源对应的INTPND位写入1，如果中断没有被屏蔽，CPU将处理该中断
- S3C2410中断控制器支持所有内置硬件各组件的硬件中断，包括24个外部可屏蔽中断
  - EINT0\~EINT32以及**ADC**、**RTC**、**SPI**、**I<sup>2</sup>C**、UART0/UART1、SDI、**USB**、DMA0/1/2/3、LCD、WDT、TIMER0/1/2/3、电池错误中断等
  - 除屏蔽寄存器初始值（复位后的值）为全1外，其他寄存器初始值均为0

### 考点-24 S3C2410的实时时钟RTC

#### 1、实时时钟的概念、功能及组成
- 实时时钟RTC组件是一种能提供**日历时钟**等功能的内置硬件
- S3C2410的RTC具有的主要功能包括**BCD数据**（秒、分、时、日、月、年）、**闰年产生器**、告警功能（告警中断或从断电模式唤醒）、**独立的电源端口**（VDDRTC）、**支持毫秒滴答时钟中断作为RTOS核的滴答时钟**、**循环复位功能**等
- S3C2410的RTC由滴答时钟发生器、闰年发生器、分频器、控制寄存器、告警发生器、复位寄存器以及年、月、日、星期、时、分、秒寄存器等构成

#### 2、S3C2410的实时时钟RTC
- ![image-20210325115735625](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210325115735625.png)
- ![image-20210325115747530](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210325115747530.png)

### 考点25 S3C2410的通用I/O接口GPIO

#### 1、S3C2410的通用I/O接口GPIO的介绍
- S3C2410的GPIO端口有GPA、GPB、GPC、GPD、GPE、GPF、GPG、GPH多个并行I/O接口
  - GPA0\~GPA22功能单一，仅作为地址线的控制线使用
  - GPB0\~GPB10可作为输入/输出，其中GPB0\~GPB4还可以作为PWM的输出TOUT0\~TOUT3
  - GPC和GPD作为LCD液晶屏接口引脚
  - GPE可作为输入/输出，还可以为I<sup>2</sup>C、I<sup>2</sup>S、SD卡等串行总线的引脚
  - GPF和GPG可设置为输入/输出端口，也可以设置为外部中断
  - GPH除可作为输入/输出外，主要作为三个UART串行通信相关引脚
- 具体某端口作为什么样的端口和功能使用，**由其对应的控制寄存器相关位决定**，GPACON\~GPHCON为GPA\~GPH的控制寄存器。GPACON、GPBCON、GPCCON、GPDCON的地址分别为0x56000000、0x56000010、0x56000020、0x56000030
- 每个端口都有控制寄存器、数据寄存器以及上拉寄存器

### 考点26 S3C2410串行通信接口UART

#### 1、UART线路控制寄存器
- S3C2410/S3C2440有三个UART接口UART0\~UART2，其对应的线路控制寄存器为ULCON0\~OLCON2，用于**确定传输帧的格式**，地址分别为0x50000000、0x50004000和0x50008000，可读写，复位时全为0
- ![image-20210325122210966](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210325122210966.png)

#### 2、UART控制寄存器
- 三个UART对应的控制寄存器UCON0\~UCON2地址分别为0x50000004、0x50004004和0x50008004
- ![image-20210325122310249](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210325122310249.png)

#### 3、UART发送/接收状态寄存器
- 三个UART对应的发送/接收状态寄存器为UTRSTAT0\~UTRSTAT2，地址分别为0x50000010、0x50004010和0x50008010，只读
- ![image-20210325122419748](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210325122419748.png)

#### 4、UART数据及存储器
- UART数据寄存器分发缓冲寄存器UTXHn和接收缓冲寄存器URXHn，数据发送都是通过发送缓冲器发送的，接收到的数据也存放在缓冲器中
- 三个通道的UART的发送缓冲器为UTXH0\~UTXH2，地址分别为0x50000020、0x50004020和0x50008020
- 三个通道的UART的接收缓冲器为URXH0\~URXH2，地址分别为0x50000024、0x50004024和0x50008024

#### 5、UART波特率除数寄存器
- UART的波特率由除数寄存器决定，也取决于外部时钟
- **UBRDIVn=INT(UCLK/(波特率x16))-1**
  - ULCK还可以是PCLK或UEXTCLK，由相应控制寄存器决定
- 三个通道的UART的波特率除数寄存器为UBRDIV0\~UBRDIV2，地址分别为0x50000028、0x50004028和0x50008028

### 考点27 S3C2410的I²C总线接口

#### 1、S3C2410内置I²C内部结构
- S3C2410内部有一个I²C总线接口，具有**主发送**模式、**主接收**模式、**从发送**模式、**从接收**模式4种模式

##### S3C2410内置I²C内部结构
- I²C总线控制逻辑、I²C总线控制寄存器IICCON、状态寄存器IICSTAT、4位预分频器、地址寄存器、比较器、数据移位寄存器HCDSey及数据总线
- ![image-20210326163444011](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326163444011.png)

#### 2、S3C2410内置I²C总线的读写格式
- I²C总线的从地址是指从器件的编码，不同从地址代表不同器件，不同器件其从地址编码不同。**同一类器件从地址编码相同**
- 有两种不同的从地址形式，一种是**7位地址**，一种是**10位地址**
  - ![image-20210326163700899](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326163700899.png)
  - ![image-20210326163724049](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326163724049.png)

#### 3、S3C2410与铁电存储器的连接
- S3C2410连接基于I²C总线的铁电存储器FM24CL64(8KB)。
- 对于FM24CL64的操作，在初始化时，**当GPE15与GPE14配置为I²C总线的SDA和SCL**，然后按照上面的主模式下的发送和接收操作流程就可以进行正常的读写操作
- ![image-20210326164031052](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326164031052.png)

### 考点28 S3C2410的看门狗定时器
- 看门狗定时器的作用：**强行使系统重新复位**
- ![image-20210326164135873](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326164135873.png)
- 如图，看门狗定时器的计数脉冲周期为：<code>t_watchdog=1/(PCLK/(预分频值+1)/分频系数)</code>，由此式可知，看门狗定时器最快的计数频率为PCLK/16，最慢的计数频率为PCLK/256/128
- 如果希望T时间内看门狗能计数到0复位，则计数初值为：**WTCON=T/t_watchdog**
- ![image-20210326164509450](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326164509450.png)

### 考点29 基于UART的RS-232,485接口

#### 1、RS-232接口介绍
- 嵌入式处理器至少有一个UART接口，仅仅通过这个接口不能进行稍远距离的通信
- 为此，可采用标准的RS-232电平转换接口电路，使UART的电平转换成RS-232电平，**通信距离可达15m左右**
- RS-232采用**负逻辑传输**。*逻辑0：+3V\~+15V,逻辑1：-15V\~-3V*

#### 2、RS-485接口介绍
- RS-485接口标准采用**差分信号传输方式**，因此具有很强的抗共模干扰能力
- 其逻辑电平为：当A的点位比B高200mV以上时为逻辑1，而当B的点位比A高200mV以上时为逻辑0，传输距离可达**1200m**
- RS-485是**同名端相连**，即A与A相连，B与B相连，由于是差分传输，无需公共地，在RS-485总线上仅需要连接两根线A和B
- RS-485通常用于主从式多机通信系统，采用**轮询**方式，由主机逐一向从机寻址
- ![image-20210326165145054](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326165145054.png)

### 考点30 CAN总线接口

#### 1、CAN总线接口介绍
- RS-485不能构成多主系统，故推出了**多主系统的CAN总线接口**
- CAN总线也采用**差分传输**，只是控制器内置CRC校验，传输可靠性强，可构成多主多从系统
- CAN总线的数据帧是由**7个不同的域**组成
  - 帧起始、仲裁域、控制域、数据域、CRC域、应答域、帧结尾
  - 其中数据域的长度可选为0\~8B(每字节包含8位) 
- 一般面向控制应用领域的ARM芯片内部已经嵌入了CAN总线控制器，外部仅需要连接CAN的收发器即可构建完整的CAN网络

#### 2、基于SPI的CAN总线扩展接口
- ![image-20210326165720166](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326165720166.png)

#### 3、基于并行总线的CAN总线扩展接口
- ![image-20210326165731955](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326165731955.png)

### 考点31 以太网通信接口

#### 1、基于内置以太网控制器的以太网接口
- 有些ARM芯片如基于ARM Cortex-M3的嵌入式处理芯片**已经嵌入了以太网控制器**（MAC层），也有些芯片同时集成了物理层（PHY层）的收发器电路，因此外部仅需要连接网络变压器及RJ45插座即可构成以太网实用接口
- 具有内置以太网控制器的以太网接口如图所示，如果内置了PHY层，则图中可省去PHY层的电路
- ![image-20210326165759881](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326165759881.png)

#### 2、不带内置以太网控制器的以太网接口
- 对于没有以太网内置接口的处理器如S3C2440可以通过外加典型的以太网控制器DM9000来构建
- **DM9000实现了以太网PHY层和MAC层**的功能，包括MAC地址识别、数据帧的组装拆分与收发、CRC编码校验、输出脉冲成型、接受噪声抑制、超时重传、信号极性检测与纠正、链路完整性测试等
- ![image-20210326165809958](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210326165809958.png)

### 考点32 常用无线通信接口

#### 1、GPS模块
- 由于卫星运行轨道、卫星时钟存在误差，大气对流层、电离层对信号的影响，使得**民用GPS的定位精度只有100m**
- 目前，嵌入式系统经常使用**专用的GPS模块**，GPS与嵌入式系统的连接有多种
  - 有基于UART、SPI接口、USB、I²C还有多种接口并存的GPS模块

#### 2、GPRS模块
- GPRS是是**通用分组无线服务**的简称，它是GSM移动电话用户可用的一种移动数据业务
- GPRS可以说是GPS的延续。GPRS与以往采用的连续传输方式不同，它以**封包**方式进行数据传输，因此使用者所负担的费用是以其传输数据的数量计算，并非使用其整个频道，理论上较为便宜
- GPRS是以模块形式接入嵌入式系统的，主要模块接口有基于UART、RS-232/485接口的GPRS模块
  - **通常支持用AT命令集进行呼叫、短信、传真、数据传输等业务**

#### 3、WiFi模块
- 凡使用**IEEE 802.11系列协议的无线局域网**又称为WiFi
- WiFi模块是**UART串口**或**TTL电平转WiFi**通信的一种传输转换产品
- WiFi模块内置无线网络协议IEEE 802.11协议栈以及TCP/IP协议栈，能够实现用户串口、TTL电平、USB接口或SPI接口数据到无线网络之间的转换
- 利用WiFi模块很容易实现嵌入式系统的有线数据到无线数据的传输

#### 4、蓝牙模块
- 蓝牙是一种支持设备短距离通信（**一般在10m内**）的无线低速（**一般为1Mb/s**）通信技术
- 利用蓝牙技术，能够有效地简化移动通信终端设备之间的通信，也能够成功地简化设备与因特网之间的通信，从而使数据传输变得更加迅速高效，为无线通信拓宽道路
- 蓝牙采用分散式网络结构以及快跳频和短包计数，支持**点对点**和**点对多点**通信
- *说明*：
  - 运用典型的UART、SPI、I²C等通信接口连接的无线模块，即可很方便的实现不同形式的无线通信，不管是蓝牙、WiFi、GPRS还是GPS

## 第四章-嵌入式系统软件

### 考纲与考点分析

#### 嵌入式系统软件
1. 嵌入式系统的软件组成与实时操作系统（嵌入式系统软件组成，嵌入式操作系统的发展，实时系统与实时操作系统，嵌入式操作系统的内核结构等）；
2. 板级支持包（BSP）、引导加载程序BootLoader和设备驱动程序（硬件抽象层HAL，BSP的功能和移植，BootLoader的执行过程，U-boot及其移植，设备驱动程序的实现等）；
3. 嵌入式Linux操作系统（Linux内核，嵌入式Linux的结构组成与实时化技术，常见嵌入式Linux发行版等）；
4. 嵌入式操作系统uC/OS-II（基本特点、代码结构、任务管理与调度、系统服务、应用程序设计等）。

#### 考点分析
- 常考知识点：
  - 了解嵌入式软件的特点和结构，理解HAL、BSP、引导加载程序和设备驱动程序的概念及原理
  - 了解嵌入式操作系统的基本概念、特点、分类、主流产品
  - Linux操作系统的基础知识、Android操作系统特点、IOS操作系统的组成结构
  - uC/OS-II操作系统内核的基本特征与任务结构
  - 了解主流嵌入式操作系统的主要特点与适用领域

### 考点1 嵌入式系统的软件组成

#### 1、嵌入式软件的特点
- 软件具有**较长的生命周期**
- 软件代码时空效率要高，**实时性要求高**
- 软件**可裁剪**，尽可能去除冗余
- 软件应用环境复杂，**安全性和可靠性要求高**
- 软件**开发难度大**
- 软件面向用户、面向产品、面向应用，**受限于功能和具体应用环境**
- 软件产品**高度分散**
- 软件与硬件一体化，**软件固化存储**

#### 2、嵌入式系统的软件结构
- **简单的轮询结构**
  - 在低端嵌入式系统中，处理器的处理能力低，存储容量小，系统功能简单，通常只实现一些简单的控制操作。这种嵌入式系统**不需要操作系统支持，应用软件直接在裸机上运行**
  - 特点
    - 程序结构简单，便于编程
    - 由于没有中断机制，因而不会出现程序随机切换带来的潜在问题
    - 只适用于系统的任务量少，任务简单且实时性要求不高的场景
- **带中断的轮询结构**
  - 也被称为**中断驱动结构或前后台结构**
  - 特点
    - 与简单的轮询结构相比，中断驱动结构**提高了系统对紧急事件的响应速度，可并发处理不同的异步事件**
    - 在一些小型的简单嵌入式系统中应用广泛
    - 由于中断的引入使得系统软件**复杂度明显提高**
- **监控式操作系统+应用软件的结构**
  - **减少开发时间，降低系统的复杂性，保障软件质量**
  - 如车载导航设备的应用软件
  - 特点
    - 与应用软件直接在裸机上运行的简单轮询结构相比，**引入操作系统增加了系统开销**
    - 嵌入式操作系统结构允许多个任务在一个CPU上并发运行
    - **降低了**用户开发嵌入式**软件的复杂度**，并有效**保证**系统的**实时性和可维护性**
- **通用嵌入式操作系统+应用软件的结构**
  - 嵌入式系统软件通常可分为**硬件抽象层**（驱动层）、**操作系统层**和**中间件层**
    - 中间件软件是指**除了操作系统内核、设备驱动程序和应用软件之外的系统软件**
    - 中间件是具有标准程序接口和协议的通用服务
    - 选择嵌入式系统软件结构的一个**基本原则是：选择可以满足响应时间需求的最简单的结构**

### 考点2 硬件抽象层与板级支持包

#### 1、硬件抽象层(HAL)和板级支持包(BSP)的概念
- HAL和BSP都是嵌入式系统的**底层软件**

##### 硬件抽象层的概念
- HAL是**操作系统层与硬件之间**设置的独立的接口软件层，是所有直接依赖于硬件的软件
- 引入HAL的目的是**对硬件进行抽象**，使上层软件开发人员无需关心底层硬件的具体细节和差异，并且支持上层软件在不同体系结构和硬件平台之间的**移植**

##### 板级支持包的概念
- BSP可以看成是硬件抽象层在**特定操作系统环境下**的具体实现。*有的文献不区分HAL和BSP，将二者当成同义词*
- BSP的特点是**既有硬件相关性，又有软件相关性**
- BSP规范是OS相关的，支持不同OS的BSP的组织结构、想上层提供的功能以及服务接口定义都不同
- BSP代码则必须针对特定硬件**专门编写**
- BSP与硬件平台直接相关，BSP的调试有**最小系统**的调试和**外围设备驱动程序**的调试

##### BSP的功能
- 系统复位时的硬件初始化，包括处理器芯片的初始化和电路板的初始化
- 引导加载操作系统
- 为操作系统提供硬件相关的驱动程序支持

####  2、HAL和BSP实例

##### NiOS II HAL
- Altera公司推出的**32位哈佛结构**用户可配置的通用RISC软核处理器，用于支持在FPGA器件上实现可编程片上系统(SoPC)
- 最大优势是**模块化**的硬件结构，以及由此带来的灵活性和可裁剪性
- HAL系统库提供的服务包括
  - ![image-20210401222502100](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210401222502100.png)

##### Windows Embedded Compact 7(WEC7)
- 微软公司专门为小型网络设备设计的安全、组件化的实时操作系统，WEC7由三层构成，分别为最顶层的应用和服务，下一层的操作系统内核交互，**在硬件和内核层之间的就是BSP**
  - ![image-20210401222739408](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210401222739408.png)

### 考点3 引导加载程序

#### 1、引导加载程序(BootLoader)的概念和功能
- BootLoader是底层软件的一部分，嵌入式系统**上电复位后首先运行引导加载程序**。它负责系统的**上电自检、硬件初始化**、建立存储空间映射、配置系统参数、建立上层软件的运行环境，并**加载和启动操作系统**。*系统加电后，CPU执行的第一条指令就是BootLoader程序中的第一条指令，这条指令一般会存储在某种类型的固态存储设备上*
- BootLoader依赖于具体的硬件结构，一般而言支持不同的硬件结构的程序有不同的版本
- 复杂的BootLoader程序还支持简单的用户命令交互、设置操作系统启动参数、Flash ROM编程下载、读写内存、系统自检、硬件调试等监控程序(monitor)功能

#### 2、嵌入式操作系统的引导加载方式
- ![image-20210401223148900](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210401223148900.png)

#### 3、引导加载程序的执行过程
- **启动过程可以是单阶段，也可是多阶段**，后者提供更复杂的功能和更好的可移植性。但是大多数是两阶段执行过程
- **第一阶段**
  - 关闭中断
  - 处理器内部的基本寄存器设置、系统基本参数设置、时钟初始化
  - 存储器初始化，包括存储器控制器的设置、存储器自检、初始化Cache和存储器管理部件、关闭看门狗定时器
  - 初始化相关的硬件设备
  - 第一阶段的功能完成后，程序将跳转到第二阶段的**C程序**入口点继续执行
- **第二阶段**
  - 进一步完成系统初始化任务，包括处理器初始化、板级初始化、中断初始化等
  - **初始化本阶段要使用到的硬件设备**
  - 如果在RAM中运行操作系统内核，则需将内核代码和根文件系统映像从ROM存储器复制到RAM存储器，为内核执行提供合适的上下文环境
  - 向操作系统内核传递启动参数
  - 调用内核代码

#### 4、U-Boot简介
- 全称Universal BootLoader，U-Boot是**公认的功能最强、最具弹性以及更新最快的开放源码BootLoader**，是遵循**GPL**条款的代码资源最完整的一个通用BootLoader
- U-Boot支持的处理器体系结构有**PowerPC、ARM、MIPS系列、X86系列**等处理器
- U-Boot支持的嵌入式操作系统有**Linux、VxWorks、QNX**、NetBSD、RTEMS、ARTOS、LynxOS等
- 它既支持启动加载模式，也支持下载模式

### 考点4 设备驱动程序的概念

#### 1、设备驱动程序的概念

##### 设备驱动程序的概念
- 从功能方面看，设备驱动程序（是指直接与硬件相互作用并控制硬件的软件）
- 从驱动程序调用者角度出发，驱动程序是对硬件操作的抽象，方便实现高层软件对硬件的访问
- 不同的系统，驱动程序的概念有所不同，但是驱动程序的基本特性大致可以概括为
  - 只能被高层软件调用而无法自行运行
  - 对上层软件屏蔽硬件细节，对下层硬件直接进行操作

##### 设备驱动程序的功能
- **设备初始化**
  - 初始化操作在系统上电或复位时初始化硬件
- **设备打开（激活）和关闭**
  - 打开设备操作使设备处于工作状态
- **设备读取和写入（即数据收发）**
  - 设备读取操作指从设备接收数据并提交给高层软件，设备写入操作则把数据发送给设备，数据收发可以采用查询、中断或DMA方式
- **设备状态查询和设备控制操作**
  - 在设备使用过程中，可能需要査询设备的当前工作状态，并根据操作需求对设备进行控制

#### 2、设备驱动程序的实现方式
- 小型的嵌入式操作系统如uC/OS-II只包括操作系统内核，包括设备驱动程序，且编写设备驱动程序无统一框架
- 大型嵌入式操作系统如WinCE、Linux、VxWorks等中，定义了统一的设备驱动程序框架，VxWorks除了通过标准驱动程 序接口访问硬件外，允许应用程序绕过操作系统直接访问硬件
- Linux等类Unix操作系统还会**把I/O设备抽象成设备文件**
- 很多操作系统不允许运行在用户态的应用程序直接访问物理端口，因而要求驱动程序必须在内核态（内核模式）运行，用户的应用程序必须通过驱动程序才能访问硬件

#### 3、VxWorks的I/O系统与设备驱动程序
- VxWorks操作系统由高性能实时内核Wind、文件系统、I/O系统、网络协议栈和板级支持包组成
- BSP、网络驱动程序和驱动程序等构成硬件抽象层
- 设备驱动程序包括如下三个部分
  - ![image-20210402173049381](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210402173049381.png)

### 考点5 实时系统与实时操作系统

#### 1、实时系统

##### 实时系统的概念
- 实时系统(Real-Time System)是必须在**有限和确定**的时间内对**外部事件**作出响应的信息系统
- **时限**(deadline)是实时系统追求的最重要指标，分为**相对时限和绝对时限**
- 评判实时系统的关键并不是系统对外部事件的处理速度，而是处理事件的时间的可预见性和确定性

##### 实时系统中运行的任务类型
- 实时系统中运行的任务可根据时限对系统性能的影响程度分为三种类型
- ![image-20210402173446158](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210402173446158.png)
- **注意**
  - 硬实时、软实时与准实时的概念与时限的长短没有关系，而与其**对超过时限的容忍程度**有关。相对软实时系统，硬实时系统的时限并不一定更短。实时系统是由硬件和软件组成的完整系统，硬件和软件必须协同配合，共同支持系统对实时性的要求

##### 实时系统与嵌入式系统的关系
- 嵌入式系统与实时系统既有区别又相互联系
- **嵌入式系统并不都是实时系统，而实时系统也不都是嵌入式系统**
- 通用计算机系统经过特殊配置后也可以完成实时控制功能。因此可以说实时嵌入式系统是嵌入式系统与实时系统的交集

##### 实时系统的特征
- **时间约束性**
  - 保证**在规定的时限内完成相应任务是实时系统设计的关键**。外部数据的获取处理和数据的输出都必须在截止时间之前完成 
- **可预测性**
  - 可预测性包括硬件延迟的可预测性，也包括软件执行时间的可预测性 
- **可靠性**
  - 在非实时系统中，偶尔故障可通过重启系统来解决。可靠性在实时系统中比非实时系统中更重要
- **交互性**
  - 实时系统必须与外部环境实现良好的协同与交互	

#### 2、实时操作系统(Real-Time Operating System,RTOS)的概述
- 实时系统必须在规定的时间内正确地完成任务，**完成任务的时间与硬件、操作系统和应用软件都有关系**
  - 能够满足实时系统需求的操作系统就是实时操作系统
- 实时操作系统最关键的特性就是**完成每次任务所需时间的一致性**
  - 如果一个实时操作系统能够完全满足确定性的时限要求，则称为硬实时操作系统，否则称为软实时操作系统。
  - 另一种说法，实时系统按时间响应的快慢有*强实时系统、普通实时系统、弱实时系统*
- 实时操作系统大多采用如下机制来保证对实时任务的响应和处理的时间确定性
  - ![image-20210402174858337](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210402174858337.png)

#### 3、实时操作系统的实时性指标
- ![image-20210402174918225](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210402174918225.png)

### 考点6 嵌入式操作系统概述

#### 1、嵌入式操作系统的特点
- **代码固化存储，时空效率高**
  - 嵌入式操作系统必须结构紧凑，代码占用存储空间小，执行效率高
- **可裁剪性**
  - 支持开放性和可伸缩性的体系结构
- **实时性**
  - 大多数嵌入式系统都是实时系统，而且多是强实时、多任务系统
- **强稳定性，弱交互性**
  - 嵌入式操作系统具有较强的稳定性与用户的交互性较弱
- **硬件适应性**
  - 运行在不同体系结构的多种硬件平台上，有可移植性

#### 2、嵌入式操作系统的分类
- 按**实时性**分类
  - **硬实时操作系统**
    - 主要用于通信、军事、航空控制等领域
    - VxWorks、RTEMS、QNX、uC/OS-II、Nucleus
  - **软实时或非实时操作系统**
    - 主要用于类PC手持设备、家用电器、个人通信终端、智能移动电话、机顶盒、MP3/MP4播放器、家庭媒体网关、WinCE、多户嵌入式
- 按**开发方式**分类
  - **专为嵌入式环境开发的嵌入式操作系统**
    - 更多地应用在对系统可靠性和实时性要求很高的军用产品、通信系统、工业控制领域等
  - **从通用计算机操作系统移植而来的嵌入式操作系统**
    - 非常适合在类PC嵌入式系统和消费类电子产品上使用、嵌入式Windows产品、嵌入式Linux产品
    - 智能手机、机顶盒
- 按**商业模式**分类
  - **免费的嵌入式操作系统**
    - 这类软件技术公开，研究者众多，更新速度快，开发资源丰富，但稳定性和技术支持一般较差
    - RTEMS、eCOS、FreeRTOS
  - **商业嵌入式操作系统**
    - 这类通稳定性最强、可靠性高，有完善的技术支持和售后服务，但产品价格昂贵
    - VxWorks、uC/OS系列
    - 有些商业系统（如uC/OS系列）只收取每种产品一次性费用，风河公司的VxWorks既按开发版本的授权数量收取授权费，也按最终产品售出的实际数量收取每份运行软件的版权费

#### 3、嵌入式操作系统的内核结构
- 是操作系统中的一组**核心程序模块**，作用是管理系统资源、支持多任务并发执行，具有访问硬件设备和所有主存空间的权限，是系统中仅有的能够执行特权指令的程序。操作系统的内核结构分成两类：单内核和微内核

##### 单内核（宏内核）结构
- 有些操作系统把内核的各个功能模块（如进程管理、文件系统、设备管理、网络通信等）整合在一起，模块间的交互通过直接调用其他模块中的函数来实现，**执行效率高，性能好**
- ![image-20210402180950265](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210402180950265.png)
- 优点
  - 性能较好，系统调用，功能切换和通信开销比较小
- 缺点
  - 即使不使用的功能组件和设备驱动程序也常驻在内存中，占用资源较多，维护工作量大
- 单内核结构的操作系统有
  - 传统的Unix、BSD Unix、Linux、MS-DOS、Windows 9x、Windows CE、Android、WinCE、Mac OS

##### 微内核结构
- 操作系统仅将必需的基本功能（如任务调度、任务间通信、低级存储管理、中断处理等 放人内核，它们运行在核心态；其他功能都在内核之外，由在用户态运行的服务来完成，这种做法**使内核的结构很小**
- ![image-20210402181308425](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210402181308425.png)
- 优点
  - **内核精巧**，结构紧凑，占用内存少
  - **开发和维护方便**，系统可以动态更新服务模块
  - **接口一致**，用户态任务不需要区分是内核级服务还是用户级服务
  - **可扩展性与可配置性强**，很合嵌入式系统的可裁剪要求
  - 可靠性高，各服务进程在用户态运行，**有自己的内存空间**
  - **支持分布式系统**，服务器可以在不同的处理机上运行
- 缺点
  - 效率较低、性能相对较差，因为通信和上下文切换的**开销大大增加**
- 微内核结构的操作系统有
  - AIX、Mach、Minix、VxWorks、QNX、Symbian、uC-OS-II、iOS
- 分层和模块化相结合的结构将操作系统分为应用软件层、中间件层、操系统层和硬件抽象层，每层再划分功能 模块，**移植工作集中在硬件抽象层**

#### 4、常用嵌入式操作系统简介
- **VxWorks**（风河公司）
  - 针对嵌人式环境开发的商用嵌入式实时操作系统，可靠性高、实时性强开发环境友好
  - VxWorks采用微内核结构，内核仅提供多任务环境、任务间通信和同步功能
  - 广泛应用在**通信、军事、航空、航天**等高新技术及实时性，如卫星通信、弹道制导、飞机导航等
  - VxWorks操作系统支持PowerPC、68K、CPU32、i9060、x86、MIPS等多种嵌入式处理器体系结构
- **QNX**（QNX软件系统公司）
  - 是一款商业分布式、可扩充的实时操作系统
  - 应用在汽车领域、网络通信、核电站和无人驾驶坦克的控制系统，RIM公司的BlackBerry PlayBook平板计算机等
  - 其内核仅提供**4种服务**：进程调度、进程间通信、底层网络通信和中断处理
  - QNX同时支持进程和线程两种任务实现方式，保证了基于QNX的应用系统稳定、可靠、强壮
- **Nucleus PlUS**（Mentor Graphics/ATI公司）
  - 又称Nucleus RTOS，是ATI公司为实时嵌入式应用而设计的**抢占式多任务商业操作系统内核**
  - 微内核非常小巧，便于移植
- **嵌入式Windows**（微软公司）
  - 主流产品可划分为嵌入式操作系统(EOS)和设备平台(device platforms)两类
  - 基于**Windows Phone 8**平台的Windows Embedded 8 Handheld(手持版)是由于手持设备的设备平台
- **RTEMS**（GPL开源的无版税嵌入式实施操作系统）
  - 属于**微内核抢占式实时系统**，非常稳定且运行速度快，占用系统资源少，支持多处理器，提供完整的TCP/IP协议栈以及FTP、Webserver、NFS等服务
  - 在通信、航空航天、工业控制，军事等领域有着非常广泛的应用
- **TinyOS**无线传感器网络操作系统（加州大学伯努利分校）
  - **开源嵌入式**操作系统，专门为**硬件资源**极为有限的**无线传感器**网络应用而量身定制
  - 拥有两级调度和**轻量级**线程技术
  - 操作系统基于**组件架构**，包括网络协议、分布式服务器和传感器驱动组件，以及一些可以在收集数据时使用的应用工具
  - 技术特点：**轻线程、主动消息、事件驱动和组件化编程**
- **eCOS**
  - 主要应用于**低成本和便携式**的消费电子、电信、车载设备和手持设备等
- **FreeRTOS**
  - **完全免费且源码公开**，是一个轻量级的开源迷你实时操作系统内核
  - 具备可移植、可裁减、调度策略灵活等特点，其内核小巧，占用存储空间少，因而可以方便地移植到各种单片机上运行

### 考点7 Linux内核

#### 1、Unix与Linux

##### Unix概述
- Unix支持**多用户和多任务**，网络和数据库功能强大，支持多种处理器架构，依靠可靠性高和可伸缩性突出等优势在**巨型计算机、服务器和工作站**等多种硬件平台上均处于操作系统领域的主流地位
- Unix作为主流的操作系统，有商业版Unix如Solaris、UnixWare、AIX、HP-UX等。技术上与Unix相似的，包括Linux、QNX、VxWorks、安卓、iOS等

##### Linux概述
- 类Unix系统中最著名的是Linux，起源于芬兰赫尔辛基大学的学生**林纳斯•托瓦兹**
- Linux**没使用任何版本Unix的源码，而是完全重新编写**，Linux成功模仿Unix系统，具有Unix操作系统的全部功能。*Linux的源代码与Unix的源代码是完全不同的，尽管函数和命令的功能、处理结果、函数名称和参数十分相同，以及Unix的行命令、驱动程序和应用程序在Linux上能够运行*
- Linux是一种**自由软件**，它的**源代码始终公开**。*对于不同体系的CPU，Linux内核的源代码各不相同*
- 2011年7月，Linux内核3.0版正式发布；2014年2月最新内核的稳定版本是3.13.2

#### 2、Linux与自由软件

##### 自由软件
- 不受限制地自由使用、复制、研究、 修改和分发的软件
- 自由软件必定是开源软件
- 软件的使用者有掌控该软件的自由
- 大部分自由软件通过互联网发布且不收取任何费用
- 自由软件一旦**按GPL授权发布**，它将永远具有GPL授权

##### 免费软件
- 无需付费就可取得的软件
- 通常带有种种限制，例如功能受限、使用时间受限、不允许修改和分发
- 软件源码也不一定公开

#### 3、Linux内核与Linux发行版
- 通常所说的“Linux操作系统”是指Linux发行版，是为一般用户预先集成好的Linux操作系统内核及各种应用软件
- 一个典型的Linux发行版除**Linux内核**之外，还包括系统安装工具、实用程序、命令行程序shell、**图形用户界面**、 常用的应用软件以及其他的一些自由软件等
- Linux发行版最早也最有名的是**GNU/Linux操作系统**。它是**可移植性**最好的操作系统内核，从游戏机、掌上计算机到大型机和巨型机都可以移植使用

### 考点8 嵌入式Linux操作系统

#### 1、Linux内核的结构与组成

##### Linux内核结构
- Linux**是参照Minix开发的**，但Linux并没有采用Minix使用的微内核设计，而是采用了与Unix相同的**单内核结构**
- Linux支持**动态装载**内核模块和内核线程，Linux内核运行在**单独的内核地址空间**
- GNU/Linux操作系统的基本组织结构
  - ![image-20210404093701229](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210404093701229.png)

##### Linux内核空间大致划分成三个层次
- 最上层是系统调用接口，是内核与应用程序进行交互的唯一接口
  - 应用程序或GLIBC通过系统调用访问内核中的特定函数
- 中间层是内核的核心部分，它的主要功能是管理系统资源、确保系统安全和隔离保护各个用户
  - **内核中有初始化组件、进程调度器、内存管理器、虚拟文件系统、设备驱动程序、进程间通信、可加载模块、网络接口**
- 最下层是BSP，这部分代码用于支持特定体系结构的处理器和特定的硬件平台
  - 例如引导加载程序，以及与DMA、MMU设置、中断处理相关的代码等

##### Linux内核组件之间的关系
- ![image-20210404094127189](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210404094127189.png)

#### 2、Linux的实时化技术

##### Linux内核的改造方式
- **内核补丁方式**
  - 保留了全部的Linux应用编程模式，实时任务和普通的同样的编程方式并使用同样的API
  - 实例如MontaVista Linux
- **双内核方式**
  - 在系统中增加微内核形态的第二个内核，并作为硬件与通用Linux内核间的抽象接口
- **超微内核方式**
  - 硬件抽象层使得实时内核和非实时内核之间由紧耦合关系变为松耦合关系，对系统的稳定性以及代码维护都非常有利
  - 实例如操作系统自适应域环境**ADEOS**

#### 3、嵌入式Linux操作系统的构建
- **基于通用Linux内核构建嵌入式Linux**
  - 优点是成本低、内核版本更新及时
  - 缺点是定制和裁剪工作量较大，且实时性相对较差
- **基于嵌入式Linux发行版构建嵌入式Linux**
  - 优点是内核的实时性高、定制和裁剪工作量小、针对性强、有专门团队的技术支持等
  -  缺点是版本更新不一定及时，成本较高
  - 国内外嵌入式Linux发行版本众多，国际上比较有代表性的有**uCLinux、RTlinux、MontaVista Linux、Wind River Linux**等产品，国内也有中科院红旗嵌入式Linux、中软实时嵌入式Linux等

### 考点9 Android操作系统

#### 1、Android系统的特点
- Android是用于智能手机、平板电脑等**移动设备**的软件包，其核心是以**Linux内核**为基础的**半开放源代码**操作系统
- 对移动设备用户来说，Android平台提供的网络、绘图、处理能力可以带来**更好的用户体验**
- 对移动设备制造商来说，Android是一个**免费的和开放的**操作系统平台，设备制造商可在这个平台随意增添特有的装置或功能，且无须为售出的每台设备支付版税
- 对移动设备的应用开发者来说，平台上的应用程序可以兼容于运行Android的各种型号的设备
- Android是一个**对第三方软件完全开放的平台**，开发者拥有很大的自由度

#### 2、Android系统的组成与结构
- Android系统采用堆层式软件架构，从底层到高层分四层
- ![image-20210404094832081](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210404094832081.png)

### 考点10 IOS操作系统

#### 1、IOS操作系统概述
- IOS与MacOS X一样，都是以类Unix的Darwin开源操作系统为基础的，因此IOS也属于类Unix的商业操作系统
- IOS的系统架构分成四个层次
  - 核心操作系统层(Core OS layer)
  - 核心服务层(Core Services layer)
  - 媒体层(Media layer)
  - 触控界面层(Cocoa Touch layer)
  - ![image-20210404095529980](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210404095529980.png)

#### 2、IOS应用开发
- 在IOS系统中，应用程序由用户代码和苹果公司提供的框架(Framework)组成，框架包含方法资源库，是帮助应用程序完成各种特定功能的软件库
- 应用程序通过框架的应用编程接口(API)调用这些功能，API指定可用的类、数据结构和协议，使用框架既省时省力，又可确保代码高效、安全，而**系统框架则是访问底层硬件的唯一途径**

### 考点11 uC/OS-II操作系统特点

#### 1、uC/OS-II的主要特点
- ![image-20210404095808459](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210404095808459.png)

#### 2、uC/OS-II系统的组成
- ![image-20210404095745590](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210404095745590.png)

#### 3、uC/OS-II的源代码主要组成
- ![image-20210404095826808](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210404095826808.png)

### 考点12 uC/OS-II任务及其管理

#### 1、uC/OS-II的任务构成
- uC/OS-II中，**任务是操作系统的基本调度单位**，由操作系统内核管理，任务之间使用系统服务进行同步与通信

##### uC/OS-II的任务构成 
- **程序代码**
  - 任务代码实际上是一个没有返回值的C函数
  - 任务函数的入口参数，通常定义成一个void类型的指针，允许用户程序传递任何类型的参数给任务
  - 任务的返回值必须是void类型，但任务永远不会返回
- **任务堆栈**
  - **每个任务都有自己独立的栈空间**，用于保存任务的工作环境
  - 用户在创建任务时必须知道处理器的栈顶在低地址还是栈顶在高地址
  - **每个任务的栈空间大小不同**
- **任务控制块**(TCB)
  - 用于**保存任务状态和属性的数据结构，在任务创建时被初始化**
  - 多个任务的TCB构成双向循环链表

#### 2、uC/OS-II的任务状态
- **休眠态**(Dormant)
  - **任务代码驻留在内存中但还没有交给内核调度的状态**
  - 调用创建任务函数可以把任务提交给内核管理
- **就绪态**(Ready)
  - 任务已经准备好，**可以运行，但因优先级比正在运行的任务低而暂时不能运行**的状态
- **运行态**(Running)
  - 任务已经获得处理器使用权而正在运行的状态
  - 任何时刻系统中只有一个任务处于运行状态
- **等待态**(Waiting)
  - 也称挂起态(pending)，正在运行的任务因等待某一事件发生而将处理器的使用权出让给其他任务而将自身挂起的状态
  - 等待的事件可以是外设的I/O操作、事件信号量、共享资源被释放、超时时间到达等
- **被中断态**(Interrupted)
  - 因处理器执行中断服务程序而被暂停运行的任务状态

#### 3、uC/OS-II的任务调度
- uC/OS-II可以管理**64**个任务，用户任务最多可以有**56**个。uC/OS-II预定义了两个系统任务为应用程序服务：
  - 空闲任务：每个应用系统必须使用空闲任务，系统总是把最低优先级固定赋给空闲任务，该任务在没有其他任务 处于**就绪态**时运行
  - 统计任务：可选的统计任务每秒钟运行一次
- 当前程序进入临界区时，不希望系统进行任务调度和处理器转入中断服务程序，在uC/OS-II中有两种解决方法：
  - 利用宏OS_ENTER_CRITICAL()和OS_EXIT_CRITICAL()实现**关中断和开中断**。
    - OS_ENTER_CRITICAL()使系统进入**临界状态**
    - OS_EXIT_CRITICAL()则实现**退出临界状态**
- 注意：
  - uC/OS-II采用基于优先级的调度算法，任务调度时，内核选择当前所有就绪任务中最高优先级的任务转入**运行态**。
  - 发生任务级的任务调度时，内核通过系统函数OS_TASK_SW()进行任务级的任务切换，**保存当前任务的上下文**，并恢复新任务的上下文

#### 4、uC/OS-II的中断处理
- ![image-20210404100859732](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210404100859732.png)

### 考点13 uC/OS-II的系统服务

#### 1、uC/OS-II的任务管理程序 
- uC/OS-II通过以下系统函数进行任务管理，并以优先级（INT8U prio）作为任务的标识
- **任务创建**
  - 任务可以在调用OSStart()之前创建，也可在其他任务的运行过程中被创建，但不能由中断服务程序创建
  - 函数OSTaskCreate()和OSTaskCreateExt()都可以创建任务
- **任务删除**
  - 删除任务的操作将使任务转入休眠状态，不再被内核调度
  - 函数OSTaskDel()既可以删除任务自身，也可以删除其他任务
- **任务挂起与任务恢复**
  - 调用OSTaskSuspend()函数可以挂起一个任务，而被挂起的任务只能等待其他任务调用OSTaskResume()函数才能实现任务恢复
  - 如果任务在被挂起时正在等待延时，则挂起操作将被取消

#### 2、uC/OS-II的时钟节拍与时间管理服务
- **用户必须在调用OSStart()启动多任务调度以后再开启时钟节拍器**，且在调用OSStart()之后做的第一件事就是**初始化定时器中断**
- 处于运行态的任务可以通过调用函数OSTimeDly()或OSTimeDlyHMSM()延迟一段时间。运行态任务将在调用函数之后转入**等待状态**，直到等待的时间到达（超时）后，OSTimeTick()将使该任务转入**就绪态**
- 参数hours、minutes、seconds和milli分别为延时时间的小时数(0\~255)、分钟数(0\~59)、秒数(0\~59)和毫秒数(0\~999)。*实际的延时时间是时钟节拍的整数倍*
- 如果某个任务因调用函数OSTimeDly()或OSTimeDlyHMSM()而进人延时等待状态，其他任务可以调用void OSTimeDlyResume(INT8U prio)将其唤醒

#### 3、uC/OS-II的任务间通信与同步服务概述
- uC/OS-II中，在任务间共享数据和实现任务间通信的方法：**信号量、消息邮箱和消息队列、互斥信号量(mutex)和事件标志组**
- 任务或者中断服务程序可以通过**事件控制块(ECB)**向其他任务发出信号。任务也可以在ECB上等待其他任中断服务程序向其发送信号务或 但**中断服务程序不能等待信号**
- 当任务因等待信号而被挂起时，当前优先级最高的就绪态任务将立即得到处理器的控制权。该事件发生后，被挂起的任务将转入就绪态
- 说明：
  - 多个任务可以同时等待同一事件的发生
  - 当该事件发生后，所有等待该事件的任务中优先级最高的任务 将获得该信号并转入**就绪状态**
  - 互斥信号量通常**用于实现对共享资源的独占访问**，还可以**解决优先级反转问题**
  - 函数OSSemPost()释放信号量，函数OSSemPend()用于等待一个信号量

##### uC/OS-II操作系统中用于保护任务间的共享数据并支持任务之间的通信的方法
- 利用宏OS_ENTER_CRITICAL()和OS_EXIT_CRITICAL()实现关中断和开中断
- 利用函数OSSchedLock()和OSSchedUnlock()对uC/OS-II中的任务调度函数上锁和开锁
- 利用信号量(OS_EVENT_TYPE_SEM)、互斥信号量(OS_EVENT_TYPE_MUTEX)、邮箱(OS_EVENT_TYPE_MBOX)或消息队列(OS_EVENT_TYPE_Q)进行任务间通信

### 考点14 uC/OS-II应用程序设计

#### 1、uC/OS-II的初始化与main()函数结构简介
- 使用内核提供的任何功能之前，必须**先调用OSInit()函数进行内核初始化**
- OSInit()内核使用的所有变量和数据结构进行初始化，**创建空闲任务OS_TaskIdle()并使之处于就绪态**
- **函数OSStart()将启动多任务调度**，并从就绪态任务中选择最高优先级的任务转入运行态，故在主函数main()调用OSStart()之前必须至少创建一个用户任务

#### 2、uC/OS-III增加的主要特性
- **时间片轮转调度**
- **内核对象的数量无限制**
- **任务级的时钟节拍处理**
- **可针对处理器体系结构进行优化**
- **时间戳**
- **增强的内置性能测试功能**

## 第五章-嵌入式系统开发

### 考纲与考点分析

#### 嵌入式系统的开发
1. 嵌入式系统的开发过程和工具（开发步骤，交叉开发平台和工具，系统的调试工具等）
2. 系统开发工具软件（ADS、RVDS的特点与使用，GCC的常用命令与参数）
3. 以S32410/S3C2440为背景的应用系统开发（硬件接口及部件的综合使用；无操作系统环境下的系统开发；uC/OS-II环境下的系统开发）

#### 考点分析
- 在考试中一般情况下会出现在*选择题和操作题（知识类型为记忆型和理解型结合，记忆型偏多）*
- 常考知识点：
  - 了解嵌入式系统开发过程及开发特点
  - 了解嵌入式系统开发平台的功能与组成
  - 掌握uC/OS操作环境下的嵌入式系统开发

### 考点1 开发嵌入式系统的基础知识
- 嵌入式系统与应用目标紧密结合，硬件资源有限

##### 嵌入式系统的开发过程步骤
- **需求分析与规格说明**
  - 把系统需求分析和规格说明分开是很有必要的，将用户对系统的描述转化为系统设计者的描述，从用户需求中整理形成正式的规格说明
  - 用户需求通常包括**功能部分**和**非功能部分**，非功能部分需求主要指：**性能、成本、尺寸、重量、功耗**
  - ![image-20210407085520663](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407085520663.png)
- **系统设计**
  - 系统设计也称为**概要设计**或**总体设计**
  - 这个阶段要完成的任务是：根据规格说明书中所描述的系统需要实现的功能，确定如何实现这些功能的**硬件和软件结构**，特别是软件和硬件功能的划分，**即哪些功能由硬件完成，哪些功能由软件完成**，以求满足系统对功能、性能、成本、功耗等的要求
- **构件设计**
  - 构件设计也称为**详细设计**，在这个阶段，设计者就需要设计或选择**符合系统结构和规格说明**中所需要的具体构件
  - **构件通常 既包括硬件（如FPGA、专用功能芯片、电路板等），也包括软件模块**
  - 实际上，系统设计和构件设计是嵌入式系统开发过程中**两个最关键**的阶段。设计者一定要遵循软硬一体、软硬协调设计的思想。在系统功能满足要求的前提下，结合性能、费用成本、时间成本、尺寸等约束条件，详细思考哪些功能由硬件构件实现，哪些功能由软件构件实现；哪些选用现成构件，哪些需要自行设计构件
- **系统集成与测试**
  - 在系统集成时，应该**分步地、按阶段地**构建系统，并且每次只对一部分构件或模块所集成的系统进行测试，这样可以更容易地发现并定位错误。测试工作应贯穿于产品开发的**每个阶段**中
  - 测试与调试既有联系又有区别。测试的目的是验证模块系统的功能和性能，发现错误。调试的任务是分析测试中发现的错误，检查原因，定位故障（错误）位置，采取适当的措施，修改软件硬件，然后返回重新进行测试

### 考点2 嵌入式系统的开发平台与工具

#### 1、嵌入式系统的开发特点
- 嵌入式系统的产品通常是与**应用目标紧密结合**的，因此，嵌入式系统产品开发有些不同于基于通用计算机的应用产品开发，主要体现在以下四个方面
  - 使用宿主机-目标机的开发架构
  - 与底层硬件控制程序的关系密切
  - 软硬件资源受限制
  - 需要固化程序

#### 2、开发平台与开发工具
- 开发平台用于支持嵌入式系统软硬件的开发，**以提高开发质量，缩短开发周期，降低开发成本**
- 开发平台中的软件开发工具往往都使用统一的用户界面并作为一个整体提供给开发人员使用，这些工具都无缝连接，相互间可自由交换数据，大大提高了开发工作的效率，所以人们也把它们称为集成开发环境(IDE)
- ![image-20210407091801592](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407091801592.png)

##### 嵌入式系统的开发平台包含大量开发工具，主要有以下几点：
- **一个面向嵌入式应用的RTOS及其函数库**
  - 如嵌入式Linux、WinCE、VxWorks等
  - 用户可根据系统的技术要求和商业要求选择合适的一种
- **一套程序开发(代码生成)工具**
  - 如**项目管理器、编辑器、编译器、连接器、定位器**等
  - 用户根据所选用的OS和编程语言(Java、C、C++)来确定要使用的工具，如ARM公司的SDT、ADS、RVDS、GNU GCC等
- **合适的调试工具**
  - 如仿真器、编程器、逻辑分析仪、开发板、评估板等
- 其他
  - 如包含各种**中间件和软件组件**的面向不同应用领域的各种应用平台等

### 考点3 嵌入式系统的调试
- ![image-20210407091835967](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407091835967.png)

#### 1、在线仿真器(ICE)
- 通常，低端（8位/16位）嵌入式系统的程序调试可以用在线仿真器(ICE)实现

##### ICE概述
- ICE具有与所要开发的嵌入式系统**相同的嵌入式处理器**
- 使用ICE进行调试时，用在线仿真器取代被调试系统的处理器，即被调试系统与ICE共用一个处理器
- ICE是目前较为有效的调试嵌入式系统的手段

#### 2、片上调试技术-JTAG
- **边界扫面和测试访问口**
  - 边界扫描测试技术是对芯片或印制电路板进行片上调试最常用的一种技术。它的基本思想是在靠近芯片的输入/输出引脚处增加一个移位寄存器，称为**边界扫描寄存器(BSR)**
  - 除了BSR之外，被调试的芯片或PCB还需要有一个测试访问口TAP，其功能是用来与宿主机进行通信，让宿主机上的调试程序可以读/写边界扫描寄存器中的内容
- **JTAG标准**
  - JTAG是IEEE的一个下属组织，任务是研究测试访问端口和边界扫描结构的标准。JTAG的研究成果被接纳为IEEE 1149.1-1990规范，成为**电子行业片上测试技术的一种国际标准**，用于芯片和电路板的测试
  - JTAG标准允许**多个**芯片（电路）的BSR通过JTAG接口**串联**在一起，实现对多个器件的测试。串接起来的扫描链包含的串行数据流可能长达几百位。例如ARM公司的ARM9TDMI处理器核内部就包含了**3个扫描链**
  - JTAG标准规定，TAP控制器中有2种寄存器：数据寄存器(DR)和命令寄存器(IR)。*边界扫描链属于数据寄存器*
- **JTAG适配器(JTAG仿真器)**
  - 目前大多数嵌入式CPU、DSP、FPGA**都支持JTAG标准**
  - 开发人员可以通过JTAG接口访问**CPU的内部寄存器和挂在CPU总线上的设备**
  - 使用JATG进行嵌入式系统的调试，**无需目标存储器，也不占用目标机任何I/O端口**
  - 通过目标机CPU芯片的JTAG接口以及内嵌的调试电路通常可以完成以下工作
    - ![image-20210407093232267](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407093232267.png)
  - 由于程序调试时不占用目标机的资源，因此目标机的初始启动程序调试、硬件接口的调试，一般都采用JTAG。至于**裸机状态**的目标机通常都采用JTAG 调试方式
  - JTAG适配器不仅是程序调试的重要工具，也是软件固化的工具。高档的JTAG适配器除了用作调试工具之外，通常都支持多种芯片的**烧写功能**，且烧写速度较快

#### 3、驻留监控软件调试
- 早期嵌入式系统的调试方法是使用驻留监控软件，这是一段固化在目标机ROM中的程序，它在目标机中运行。**这是一种成本较低的调试方法，它不需要任何其他的硬件调试和仿真设备**。如ARM公司的Angle就属于此类软件

##### Angle调试监控程序的功能
- ![image-20210407093622171](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407093622171.png)

#### 4、指令集模拟器
- 指令集模拟器(Instruction Set Simulator,ISS)是在宿主机上模拟应用程序在目标机上运行行为的一个软件工具
- ARM体系结构的嵌入式系统时常用的两种指令集模拟器：**ARMulator和SkyEye**

##### 指令集模拟器主要用在以下几种场合
- 没有目标机开发板硬件
- 有目标机开发板硬件，但使用目标机开发板成本较高
- 被调试的程序模块不需要在实际开发板上执行，例如学习ARM汇编语言程序，学习ARM处理器上汇编程序、C程序和C++程序的相互之间调用方法，开发手机应用程序
- 对模块代码进行语法检查，先行排错，为连接开发板进行系统调试做好准备，以加快开发速度
- 避免对硬件不熟悉而在调试硬件方面耗费过多精力。尽快在系统高层设计和逻辑设计上取得更大成果

### 考点4 ADS1.2工具软件

#### 1、ADS1.2的工程项目
- ![image-20210407094053117](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407094053117.png)
- 一个工程项目中**至少应包含一个生成目标**，通常一个生成目标对应着一个可执行的输出文件。ARM提供的可执行输出文件的模板包括了下面3个生成目标
  - Debug生成的输出文件中包含了**所有调试信息**，用于在开发过程中使用
  - Release生成的输出文件中不包含调试信息，用于生成实际发行的软件
  - DebugRel生成的输出文件中包含了基本的调试信息
- 设计者要确定连接顺序时，建议采用以下两种方式中的一种
  - 当地址映射关系比较**简单**时，使用编译、连接选项来确定输入文件的连接顺序
  - 当地址映射关系比较**复杂**时，使用scatter（分散加载）格式的文件来确定输入文件的连接顺序

#### 2、工程项目的建立
- 可以从“新建”开始来逐步构建自己的工程项目，也可以借助于一个现成的工程项目模板，通过修改、添加等手段来 建立自己的工程项目
- 向工程项目中添加现成的已存在的文件时有以下两个方面需要注意
  - 该文件的扩展名必须是文件映射表中所定义的
  - 对于生成目标的输入文件，如C、C++源程序和汇编源程序等，在工程项目中不能重名。而对于头文件，在一个工程项目中则可以存在同名的文件，集成开发工具将搜索相关的路径，取得第一个文件

#### 3、工程项目的配置
-  一个工程项目建立后，其最终目的是使用工具生成一个能在目标机上运行的输出文件。这个输出文件是通过工程项目所对应的生成目标进行编译连接后生成的二进制文件
- ![image-20210407103202856](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407103202856.png)
- ![image-20210407103214642](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407103214642.png)

#### 4、连接中的地址映射
- ![image-20210407103235093](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407103235093.png)

#### 5、编译及调试
- 通俗地讲，下载时域就是下载时的存储空间；运行时域就是运行时的存储空间。设计者利用工具来进行地 址映射，即在编译连接其工程项目时，需要结合实际目标机上的硬件地址空间，指明程序中各段将被存储的区域基址（或称为首地址）。采用的方法就是**Simple连接类型**和**Scattered连接类型**的参数配置
  - Simple连接类型：对于地址映射关系简单的工程项目，RO Base文本框中配置的是下载时域和运行时域的基址，若没有设置任何值，其默认值是0x8000，RW Base文本框配置的是RW段和ZI段运行时域的基址
  - Scattered连接类型：对于地址映射关系较复杂的工程项目，一个Scatter文件中通常要描述一个下载时域的**首地址、域的大小、域的属性**，以及若干个**运行时域的首地址、域的大小、域的属性、包含的输入段**等信息
- 在ADS1.2的工程项目窗口中选择Project 菜单下的Compile子菜单，即可以对当前打开的工程项目所包含的输入文件进行编译，然后，在选择Project 菜单下的Make子菜单进行连接，最终生成可执行的输出文件
  - 编译新添加进入的或者刚修改过的源文件，并生成相应的目标文件
  - 接各目标文件以及库文件，生成ELF格式的输出文件
  - 进行连接后操作，比如用fromELF工具转换输出文件的格式

### 考点5 RVDS

#### 1、RVDS的功能模块
- RVDS(RealView Dev Iopment Suite)是ARM公司推出的**基于ARM系列CPU**进行开发的工具套件，是目前被认为最好的ARM开发工具。它**支持所有ARM芯片**，包括Cortex全系列，还支持其他内核的处理器，如51系列等。与ADS1.2比较而言，其生成的**代码紧凑、执行效率高**
- ![image-20210407104742035](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407104742035.png)

#### 2、RVD调试器

##### RVD调试器是RVDS工具套件中的主要功能模块，拥有一些早期调试器不具备的功能
- **条件断点**
  - 能够建立表达式和断点之间的关联，支持依据表达式的值产生断点
- **数据断点**
  - 根据指定地址单元的访问行为（如读操、写操作）来产生断点，并根据指定地址单元的值来产生断点
- **芯片I/O端口描述文件**
  - RVD调试器采用文件的方式来记录I/O端口寄存器的值
- **更方便地支持Flash ROM烧写**
- **支持在目标机的程序运行后再使用RVD连接调试**
- **支持多核调试**
  - 每个核对应一个窗口，完全可以用单核的调试手段去调试多核中的每一个核

#### 3、Trace和Profile
- ![image-20210407104811759](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407104811759.png)

### 考点6 GNU

#### 1、GCC概述

##### GNU简单介绍
- 概念：GNU是GNU's Not Unix首字母的组合，是一种常用于开发**基于Linux操作系统**的嵌入式软件的**工具套件**的简称
- 该工具套件是由Richard Stallman提出的GNU计划中的几个开源的工具组成，包括编译器、连接器、文本编辑器、语法除错等工具。*GCC是GNU开发工具套件中的核心工具软件*

##### GCC概念
- GCC是一种针对Linux操作系统环境下应用程序的**编译工具**，它能将C语言、C++语言、汇编语言编写的源程序以及库文件编译连接成执行文件
- 它从源文件生成可执行文件的过程是由四个相关联的阶段组成：**预处理、编译、汇编、连接**
- 若要生成可执行文件，无论在一个工程项目中只有一个源文件还是多个源文件，所有被编译和连接的源文件中**必须有且仅有一个**main()函数，因为main()函数是整个应用程序的入口

#### 2、GCC的命令及参数
- GCC的基本命令格式是：<code>gcc [opyion] [filenames]</code>
- 针对ARM硬件平台的目标机，其GCC的基本命令格式是：<code>arm_linux_gcc [opyion] [filenames]</code>

##### GCC命令中的参数
- **-c**
  - 该参数表示仅完成编译操作而不进行连接操作，生成后缀为.o的目标文件
- **-E**
  - 该参数表示仅完成预处理操作而不进行后续操作，生成后缀为.i的文件
- **-S**
  - 该参数表示仅完成预处理、编译操作而不进行后续操作，生成后缀为.S的文件
- **-o filename_out**
  - 该参数确定编译后的输出文件名为filename_out
- **-g**
  - 该参数使得编译器在编译时产生一个**用于调试**的符号表，设计者要对源程序进行调试，通常需要在GCC命令中加入该参数
- **-O**
  - 该参数用来确定对程序进行优化编译
- **-I dirname**
  - 该参数将目录名为dirname的目录加入到程序头文件的目录列表中
- **-fpic或-fPIC**
  - 该参数产生位置无关的目标代码。它通常用于构造共享函数库

#### 3、GDB的基本命令
- GDB是GNU开发套件中的**程序调试工具**，它可以提供单步执行和断点执行功能，并观察程序执行时变量值的变化

##### GDB的基本命令
- **file**
  - 该命令是装入需要调试的可执行文件,如file test
- **run**
  - 该命令**执行当前被调试的程序**
- **kill**
  - 该命令终止当前被调试的程序运行
- **next**
  - 该命令执行一行源代码，若遇函数调用则不进入函数内部
- **step**
  - 该命令执行一行源代码，若遇函数调用则进入函数内部
- **break**
  - 该命令在代码中设置断点，使程序执行到断点处时被挂起
- **watch**
  - 该命令用来观察变量的值
- **list**
  - 该命令列出部分源代码
- **quit**
  - 该命令终止GDB运行

#### 4、GNU的使用
- ![image-20210407110208919](https://cdn.jsdelivr.net/gh/FengYJ120/CDN-Article/计算机三级嵌入式系统开发技术/image-20210407110208919.png)

### 考点7 Web服务器

#### 1、嵌入式Web服务器与通用Web服务器的差别
- **两者运行的目标环境不一样**
  - 通用Web服务器一般运行在计算资源和内存资源都比较丰富的通用计算机上，而嵌入式Web服务器运行的目标系统大多是各类专用设备上，**资源比较缺乏**
- **两者在各自系统中的作用不一样**
  - 通用Web服务器主要是利用 服务器向用户提供信息服务，而嵌入式Web服务器嵌入在设备中，其主要作用是**控制和管理设备**，也向客户提供设备的运行状态信息
- **两者运行的优先级不一样**
  - 嵌入式Web服务器在系统中作为一种**监控、管理手段**，它不能干扰设备主要任务的运行

#### 2、基于嵌入式Web服务器的应用架构
- 基于嵌入式Web服务器的应用需求与通用Web服务器的**应用需求是不同的**，它不是以提供信息服务为主，而是提供一个**基于远程客户端**的操控方式
- 即所谓的浏览器/服务器结构(B/S结构）的操控方式，用户在远程的客户机上，**通过浏览器与嵌入式Web服务器交互**，从而操控被嵌入的设备
- Web服务器是嵌入在设备中的，**通常与设备的控制系统融合为一体**，因此称其为嵌入式Web服务器

